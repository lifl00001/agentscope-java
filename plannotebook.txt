
 * â–â–›â–ˆâ–ˆâ–ˆâ–œâ–Œ *   Claude Code v2.0.76
* â–â–œâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–›â–˜ *  Sonnet 4.5 Â· API Usage Billing
 *  â–˜â–˜ â–â–  *   D:\StuWorkSpace\springaialibaba\agentscope-java

  /model to try Opus 4.5
  â†‘ Install the PyCharm plugin from the JetBrains Marketplace:
    https://docs.claude.com/s/claude-code-jetbrains

> /ide 
  â¿  IDE selection cancelled

> @..\..\..\mnt\d\StuWorkSpace\springaialibaba\agentscope-java\agentscope-ex
amples\quickstart\src\main\java\io\agentscope\examples\quickstart\PlanNotebo
okExample.java#L146-229 è¯´è¯´plannotebookå®ç°ä»€ä¹ˆåŠŸèƒ½ï¼Œè§£å†³ä»€ä¹ˆé—®é¢˜ 

â— æˆ‘æ¥å¸®ä½ äº†è§£ PlanNotebook çš„åŠŸèƒ½ã€‚è®©æˆ‘å…ˆæŸ¥çœ‹å®Œæ•´çš„ä»£ç å®ç°ã€‚

â— Read(agentscope-examples\quickstart\src\main\java\io\agentscope\examples\quick
      start\PlanNotebookExample.java)
  â¿ Â Read 231 lines

â— Search(pattern: "class PlanNotebook", type: "java")
  â¿ Â Found 7 files (ctrl+o to expand)

â— Read(agentscope-core\src\main\java\io\agentscope\core\plan\PlanNotebook.java)
  â¿ Â Read 1026 lines

â— PlanNotebook åŠŸèƒ½ä¸é—®é¢˜åˆ†æ

  æ ¸å¿ƒåŠŸèƒ½

  PlanNotebook æ˜¯ä¸€ä¸ªç»“æ„åŒ–è®¡åˆ’ç®¡ç†ç³»ç»Ÿï¼Œä¸º Agent æä¾›äº†è§„åˆ’å’Œè·Ÿè¸ªå¤æ‚ä»»åŠ¡çš„èƒ½åŠ›ã€‚ä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼š

  1. è®¡åˆ’ç”Ÿå‘½å‘¨æœŸç®¡ç†

  æä¾› 10 ä¸ªå·¥å…·å‡½æ•°ï¼ˆagentscope-core/.../plan/PlanNotebook.java:88-101ï¼‰ï¼š
  - create_plan - åˆ›å»ºæ–°è®¡åˆ’
  - update_plan_info - æ›´æ–°è®¡åˆ’åç§°ã€æè¿°ã€é¢„æœŸç»“æœ
  - revise_current_plan - å¢åˆ æ”¹å­ä»»åŠ¡
  - update_subtask_state - æ›´æ–°å­ä»»åŠ¡çŠ¶æ€
  - finish_subtask - å®Œæˆå­ä»»åŠ¡
  - view_subtasks - æŸ¥çœ‹å­ä»»åŠ¡è¯¦æƒ…
  - get_subtask_count - è·å–å­ä»»åŠ¡ç»Ÿè®¡
  - finish_plan - å®Œæˆæˆ–æ”¾å¼ƒè®¡åˆ’
  - view_historical_plans - æŸ¥çœ‹å†å²è®¡åˆ’
  - recover_historical_plan - æ¢å¤å†å²è®¡åˆ’

  2. çŠ¶æ€è·Ÿè¸ª

  - è®¡åˆ’çŠ¶æ€: TODO â†’ IN_PROGRESS â†’ DONE/ABANDONED
  - å­ä»»åŠ¡çŠ¶æ€: TODO â†’ IN_PROGRESS â†’ DONE/ABANDONED
  - é¡ºåºæ‰§è¡Œçº¦æŸ: å¿…é¡»æŒ‰é¡ºåºå®Œæˆå­ä»»åŠ¡ï¼Œå‰ä¸€ä¸ªæœªå®Œæˆä¸èƒ½å¼€å§‹ä¸‹ä¸€ä¸ª (agentscope-core/.../plan/PlanNotebook.java:601-626)

  3. æ™ºèƒ½æç¤ºæ³¨å…¥

  - åœ¨æ¯æ¬¡æ¨ç†å‰è‡ªåŠ¨æ³¨å…¥ <system-hint> æ ‡ç­¾åŒ…è£¹çš„ä¸Šä¸‹æ–‡æç¤º (agentscope-core/.../plan/PlanNotebook.java:44-47)
  - å¼•å¯¼ Agent æŒ‰è®¡åˆ’æ‰§è¡Œä»»åŠ¡
  - å¯é…ç½®æ˜¯å¦éœ€è¦ç”¨æˆ·ç¡®è®¤ (agentscope-core/.../plan/PlanNotebook.java:220-230)

  è§£å†³çš„é—®é¢˜

  1. å¤æ‚ä»»åŠ¡åˆ†è§£é—®é¢˜

  é—®é¢˜: LLM é¢å¯¹å¤šæ­¥éª¤ä»»åŠ¡æ—¶å®¹æ˜“è¿·å¤±æ–¹å‘ã€é—æ¼æ­¥éª¤ã€æ‰§è¡Œé¡ºåºæ··ä¹±

  è§£å†³æ–¹æ¡ˆ:
  - å¼ºåˆ¶ Agent å…ˆåˆ›å»ºç»“æ„åŒ–è®¡åˆ’
  - å°†å¤§ä»»åŠ¡åˆ†è§£ä¸ºå¯ç®¡ç†çš„å­ä»»åŠ¡
  - æ¯ä¸ªå­ä»»åŠ¡æœ‰æ˜ç¡®çš„åç§°ã€æè¿°å’Œé¢„æœŸç»“æœ

  2. æ‰§è¡ŒçŠ¶æ€è¿½è¸ªé—®é¢˜

  é—®é¢˜: æ— æ³•è¿½è¸ª Agent æ‰§è¡Œåˆ°å“ªä¸€æ­¥ï¼Œæ˜¯å¦åç¦»ç›®æ ‡

  è§£å†³æ–¹æ¡ˆ:
  - å®æ—¶è®°å½•æ¯ä¸ªå­ä»»åŠ¡çš„çŠ¶æ€
  - é€šè¿‡ Hook å¯è§†åŒ–è®¡åˆ’çŠ¶æ€ï¼ˆå¦‚ PlanNotebookExample.java:117-143 çš„ printPlanStateï¼‰
  - æ”¯æŒçŠ¶æ€æŒä¹…åŒ–ï¼Œå¯æ¢å¤å†å²è®¡åˆ’

  3. ä»»åŠ¡è¿è´¯æ€§é—®é¢˜

  é—®é¢˜: Agent åœ¨å¤šè½®å¯¹è¯ä¸­å¿˜è®°ä¸Šä¸‹æ–‡å’Œç›®æ ‡

  è§£å†³æ–¹æ¡ˆ:
  - æ¯æ¬¡æ¨ç†å‰è‡ªåŠ¨æ³¨å…¥å½“å‰è®¡åˆ’ä¸Šä¸‹æ–‡ä½œä¸ºæç¤º
  - ä¿æŒ Agent å¯¹æ•´ä½“ç›®æ ‡å’Œå½“å‰æ­¥éª¤çš„è®¤çŸ¥
  - StateModule æ¥å£æ”¯æŒä¼šè¯çº§åˆ«çš„çŠ¶æ€ä¿å­˜ (agentscope-core/.../plan/PlanNotebook.java:156-174)

  å®é™…ä½¿ç”¨ç¤ºä¾‹

  ä» PlanNotebookExample.java å¯ä»¥çœ‹åˆ°å…¸å‹ä½¿ç”¨æµç¨‹ï¼š

  1. Agent æ”¶åˆ°ä»»åŠ¡ï¼š"è®¡ç®—çŸ©å½¢é¢ç§¯å¹¶ä¿å­˜åˆ°æ–‡ä»¶"
  2. è°ƒç”¨ create_plan åˆ›å»º 3 ä¸ªå­ä»»åŠ¡ï¼š
     - [0] è®¡ç®—çŸ©å½¢é¢ç§¯
     - [1] ä¿å­˜ç»“æœåˆ°æ–‡ä»¶
     - [2] è¯»å–æ–‡ä»¶éªŒè¯
  3. ç³»ç»Ÿè‡ªåŠ¨æ³¨å…¥æç¤ºï¼š"å½“å‰æ­£åœ¨è¿›è¡Œå­ä»»åŠ¡ 0..."
  4. Agent å®Œæˆå­ä»»åŠ¡ 0 â†’ è°ƒç”¨ finish_subtask
  5. ç³»ç»Ÿè‡ªåŠ¨æ¿€æ´»å­ä»»åŠ¡ 1ï¼Œæ›´æ–°æç¤º
  6. é‡å¤ç›´åˆ°æ‰€æœ‰å­ä»»åŠ¡å®Œæˆ
  7. è°ƒç”¨ finish_plan å®Œæˆæ•´ä¸ªè®¡åˆ’

  å…³é”®è®¾è®¡ä¼˜åŠ¿

  1. éé˜»å¡å¼: åŸºäº Reactor çš„å“åº”å¼ç¼–ç¨‹ï¼Œæ‰€æœ‰æ“ä½œè¿”å› Mono
  2. å¯æ‰©å±•: æ”¯æŒè‡ªå®šä¹‰ PlanToHintã€PlanStorageã€çŠ¶æ€æŒä¹…åŒ–
  3. è‡ªåŠ¨åŒ–: Hook æœºåˆ¶è‡ªåŠ¨æ³¨å…¥æç¤ºï¼Œæ— éœ€æ‰‹åŠ¨å¹²é¢„
  4. å¯è§†åŒ–: æ”¯æŒç›‘å¬è®¡åˆ’å˜åŒ–ï¼ˆchangeHooksï¼‰ï¼Œä¾¿äºè°ƒè¯•å’Œç›‘æ§

> /rename 
  â¿  Please provide a name for the session. Usage: /rename <name>

> /rename plannotebookä½¿ç”¨ 
  â¿  Session renamed to: plannotebookä½¿ç”¨

> å½“å‰é¡¹ç›®çš„plannotebookå’ŒMultipleAgentsæ™ºèƒ½ä½“åœ¨æŠ€æœ¯å®ç°å’Œå®é™…åº”ç”¨åœºæ™¯åŒºåˆ«æ˜¯
ä»€ä¹ˆï¼Œå¹¶ä¸¾ä¾‹è¯´æ˜ 
  â¿ â§‰ Selected 1 lines from 
    ..\..\..\mnt\d\StuWorkSpace\springaialibaba\agentscope-java\agentscope-core\
    src\test\java\io\agentscope\core\pipeline\SequentialPipelineTest.java in 
    IntelliJ IDEA

â— æˆ‘æ¥å¸®ä½ åˆ†æ PlanNotebook å’Œ MultipleAgents åœ¨æŠ€æœ¯å®ç°å’Œåº”ç”¨åœºæ™¯ä¸Šçš„åŒºåˆ«ã€‚è®©æˆ‘å…ˆæŸ¥çœ‹ç›¸å…³çš„ä»£ç å®ç°ã€‚

â— Search(pattern: "MultipleAgents", type: "java")
  â¿ Â Found 3 files (ctrl+o to expand)

â— Read(agentscope-core\src\test\java\io\agentscope\core\pipeline\SequentialPipel
      ineTest.java)
  â¿ Â Read 186 lines

â— Search(pattern: "class.*Pipeline", type: "java")
  â¿ Â Found 11 files (ctrl+o to expand)

â— Read(agentscope-examples\quickstart\src\main\java\io\agentscope\examples\quick
      start\SequentialPipelineExample.java)
  â¿ Â Read 195 lines

â— Read(agentscope-examples\quickstart\src\main\java\io\agentscope\examples\quick
      start\FanoutPipelineExample.java)
  â¿ Â Read 288 lines

â— Search(pattern: "FanoutPipeline", type: "java")
  â¿ Â Found 8 files (ctrl+o to expand)

â— Read(agentscope-core\src\main\java\io\agentscope\core\pipeline\SequentialPipel
      ine.java)
  â¿ Â Read 100 lines

â— PlanNotebook vs MultipleAgentsï¼ˆå¤šæ™ºèƒ½ä½“ï¼‰å¯¹æ¯”åˆ†æ

  åŸºäºä»£ç åˆ†æï¼Œæˆ‘æ¥è¯¦ç»†è¯´æ˜è¿™ä¸¤ä¸ªæ¦‚å¿µçš„æœ¬è´¨åŒºåˆ«ï¼š

  ---
  ğŸ“Š æ ¸å¿ƒåŒºåˆ«æ€»è§ˆ

  | ç»´åº¦     | PlanNotebook            | MultipleAgents (Pipeline) |
  |----------|-------------------------|---------------------------|
  | æ¶æ„æ¨¡å¼ | å•æ™ºèƒ½ä½“ + å†…éƒ¨ä»»åŠ¡è§„åˆ’ | å¤šæ™ºèƒ½ä½“ + åä½œç¼–æ’       |
  | æ‰§è¡Œä¸»ä½“ | 1 ä¸ª Agent æŒ‰æ­¥éª¤æ‰§è¡Œ   | N ä¸ªç‹¬ç«‹ Agent å„å¸å…¶èŒ   |
  | ä»»åŠ¡åˆ†è§£ | Agent è‡ªä¸»åˆ†è§£ä¸ºå­ä»»åŠ¡  | ç³»ç»Ÿé¢„å®šä¹‰è§’è‰²åˆ†å·¥        |
  | åä½œæ–¹å¼ | Hook æ³¨å…¥æç¤ºå¼•å¯¼       | Pipeline ç¼–æ’æ•°æ®æµ       |
  | é€‚ç”¨åœºæ™¯ | å¤æ‚å•ä»»åŠ¡å¤šæ­¥éª¤æ‰§è¡Œ    | ä¸“ä¸šåŒ–ä»»åŠ¡æµå¼å¤„ç†        |

  ---
  ğŸ¯ æŠ€æœ¯å®ç°å·®å¼‚

  1. PlanNotebookï¼šå•æ™ºèƒ½ä½“å†…éƒ¨è§„åˆ’

  æ ¸å¿ƒæœºåˆ¶ (agentscope-core/.../plan/PlanNotebook.java:103):
  public class PlanNotebook implements StateModule {
      private Plan currentPlan;  // å½“å‰è®¡åˆ’çŠ¶æ€

      // 10 ä¸ªå·¥å…·å‡½æ•°è®© LLM è°ƒç”¨
      @Tool public Mono<String> createPlan(...) { }
      @Tool public Mono<String> finishSubtask(...) { }
      // ...

      // å…³é”®ï¼šè‡ªåŠ¨æ³¨å…¥æç¤º
      public Mono<Msg> getCurrentHint() {
          // åœ¨æ¯æ¬¡æ¨ç†å‰æ³¨å…¥ <system-hint> æ ‡ç­¾
      }
  }

  å·¥ä½œæµç¨‹:
  ç”¨æˆ·ä»»åŠ¡ â†’ Agent (å¸¦ PlanNotebook)
           â†“
      [è‡ªåŠ¨] æ¨ç†å‰æ³¨å…¥æç¤ºï¼š"å½“å‰æ­£åœ¨æ‰§è¡Œå­ä»»åŠ¡ 0..."
           â†“
      Agent è°ƒç”¨ create_plan å·¥å…·åˆ›å»ºè®¡åˆ’
           â†“
      Hook è‡ªåŠ¨æç¤ºï¼š"ç°åœ¨å¼€å§‹æ‰§è¡Œå­ä»»åŠ¡ 0"
           â†“
      Agent ä½¿ç”¨å…¶ä»–å·¥å…·å®Œæˆå­ä»»åŠ¡
           â†“
      Agent è°ƒç”¨ finish_subtask
           â†“
      Hook è‡ªåŠ¨æ¿€æ´»å­ä»»åŠ¡ 1ï¼Œæ›´æ–°æç¤º
           â†“
      å¾ªç¯ç›´åˆ°æ‰€æœ‰å­ä»»åŠ¡å®Œæˆ

  å…³é”®ä»£ç ç¤ºä¾‹ (PlanNotebookExample.java:173-195):
  ReActAgent agent = ReActAgent.builder()
      .name("PlanAgent")
      .sysPrompt("åˆ›å»ºè®¡åˆ’åæŒ‰æ­¥éª¤æ‰§è¡Œ...")
      .planNotebook(planNotebook)  // æ³¨å…¥ PlanNotebook
      .hooks(List.of(planVisualizationHook))
      .build();

  ---
  2. MultipleAgentsï¼šå¤šæ™ºèƒ½ä½“ Pipeline ç¼–æ’

  æ ¸å¿ƒæœºåˆ¶ (agentscope-core/.../pipeline/SequentialPipeline.java:24-38):
  public class SequentialPipeline implements Pipeline<Msg> {
      private final List<AgentBase> agents;  // å¤šä¸ªç‹¬ç«‹ Agent

      public Mono<Msg> execute(Msg input) {
          Mono<Msg> chain = Mono.just(input);
          // ä¾æ¬¡æ‰§è¡Œï¼šAgent1 è¾“å‡º â†’ Agent2 è¾“å…¥
          for (AgentBase agent : agents) {
              chain = chain.flatMap(agent::call);
          }
          return chain;
      }
  }

  å·¥ä½œæµç¨‹:
  è¾“å…¥æ•°æ® â†’ Translator Agent (ç¿»è¯‘)
           â†“ [è¾“å‡º: ä¸­æ–‡æ–‡æœ¬]
        Summarizer Agent (æ‘˜è¦)
           â†“ [è¾“å‡º: æ‘˜è¦æ–‡æœ¬]
     SentimentAnalyzer Agent (æƒ…æ„Ÿåˆ†æ)
           â†“ [è¾“å‡º: æƒ…æ„Ÿåˆ†æç»“æœ]
           æœ€ç»ˆè¾“å‡º

  å…³é”®ä»£ç ç¤ºä¾‹ (SequentialPipelineExample.java:68-73):
  SequentialPipeline pipeline = SequentialPipeline.builder()
      .addAgent(translator)      // Agent 1: ä¸“é—¨ç¿»è¯‘
      .addAgent(summarizer)      // Agent 2: ä¸“é—¨æ‘˜è¦
      .addAgent(sentimentAnalyzer) // Agent 3: ä¸“é—¨åˆ†æ
      .build();

  Msg result = pipeline.execute(inputMsg).block();

  ---
  ğŸ“– åº”ç”¨åœºæ™¯å¯¹æ¯”

  PlanNotebook é€‚ç”¨åœºæ™¯

  åœºæ™¯ 1ï¼šå¤æ‚æ•°å­¦è®¡ç®— + æ–‡ä»¶æ“ä½œ

  ä»»åŠ¡ï¼šè®¡ç®—çŸ©å½¢é¢ç§¯ â†’ ä¿å­˜æ–‡ä»¶ â†’ è¯»å–éªŒè¯

  // å•ä¸ª Agent è‡ªä¸»è§„åˆ’æ‰§è¡Œ
  Agent æ”¶åˆ°ä»»åŠ¡
    â†“
  è‡ªä¸»è°ƒç”¨ create_plan([
      {name: "è®¡ç®—é¢ç§¯", expected_outcome: "50"},
      {name: "ä¿å­˜æ–‡ä»¶", expected_outcome: "result.txt å·²ä¿å­˜"},
      {name: "éªŒè¯ç»“æœ", expected_outcome: "è¯»å–å†…å®¹åŒ¹é…"}
  ])
    â†“
  ä½¿ç”¨ calculate å·¥å…·è®¡ç®—
    â†“
  è°ƒç”¨ finish_subtask(0, "50")
    â†“
  ç³»ç»Ÿè‡ªåŠ¨æç¤ºï¼š"å¼€å§‹å­ä»»åŠ¡ 1ï¼šä¿å­˜æ–‡ä»¶"
    â†“
  ä½¿ç”¨ write_file å·¥å…·
    â†“
  è°ƒç”¨ finish_subtask(1, "result.txt å·²ä¿å­˜")
    â†“
  ç»§ç»­ä¸‹ä¸€ä¸ªå­ä»»åŠ¡...

  ä¼˜åŠ¿:
  - âœ… å•ä¸ª Agent å¤„ç†å…¨æµç¨‹
  - âœ… çµæ´»è°ƒæ•´è®¡åˆ’ï¼ˆå¯å¢åˆ æ”¹å­ä»»åŠ¡ï¼‰
  - âœ… é€‚åˆæ¢ç´¢æ€§ä»»åŠ¡ï¼ˆAgent è‡ªä¸»å†³ç­–ï¼‰

  ---
  MultipleAgents é€‚ç”¨åœºæ™¯

  åœºæ™¯ 2ï¼šå†…å®¹å¤„ç†æµæ°´çº¿

  ä»»åŠ¡ï¼šæ–‡ç« ç¿»è¯‘ â†’ æ‘˜è¦ç”Ÿæˆ â†’ æƒ…æ„Ÿåˆ†æ

  // é¢„å®šä¹‰çš„æµæ°´çº¿å¤„ç†
  Translator Agent (åªè´Ÿè´£ç¿»è¯‘)
    â†“ è¾“å‡ºä¸­æ–‡æ–‡æœ¬
  Summarizer Agent (åªè´Ÿè´£æ‘˜è¦)
    â†“ è¾“å‡º 2-3 å¥æ‘˜è¦
  SentimentAnalyzer Agent (åªè´Ÿè´£åˆ†æ)
    â†“ è¾“å‡ºæƒ…æ„Ÿåˆ†ç±»

  ä¼˜åŠ¿:
  - âœ… æ¯ä¸ª Agent ä¸“æ³¨å•ä¸€èŒè´£
  - âœ… å¯å¤ç”¨ Agentï¼ˆå¦‚ Translator å¯ç”¨äºå…¶ä»–æµç¨‹ï¼‰
  - âœ… å¯å¹¶è¡Œæ‰§è¡Œï¼ˆFanoutPipelineï¼‰
  - âœ… æ˜“äºæµ‹è¯•å’Œç»´æŠ¤

  åœºæ™¯ 3ï¼šå¤šä¸“å®¶å¹¶è¡Œè¯„å®¡

  ä»»åŠ¡ï¼šäº§å“åˆ›æ„å¤šç»´åº¦è¯„ä¼°

  // FanoutPipeline å¹¶è¡Œæ‰§è¡Œ
  äº§å“åˆ›æ„
    â”œâ”€â†’ Technical Expert (æŠ€æœ¯å¯è¡Œæ€§)
    â”œâ”€â†’ UX Expert (ç”¨æˆ·ä½“éªŒ)
    â””â”€â†’ Business Analyst (å•†ä¸šä»·å€¼)
    â†“
  èšåˆæ‰€æœ‰ä¸“å®¶æ„è§

  ---
  ğŸ”‘ å…³é”®æŠ€æœ¯å·®å¼‚æ€»ç»“

  PlanNotebook ç‰¹æ€§

  1. æç¤ºå·¥ç¨‹é©±åŠ¨: é€šè¿‡ <system-hint> åŠ¨æ€å¼•å¯¼ LLM
  2. çŠ¶æ€æœºç®¡ç†: å­ä»»åŠ¡çŠ¶æ€ä¸¥æ ¼å—æ§ï¼ˆTODO â†’ IN_PROGRESS â†’ DONEï¼‰
  3. é¡ºåºçº¦æŸ: å¿…é¡»å®Œæˆå‰ä¸€ä¸ªæ‰èƒ½å¼€å§‹ä¸‹ä¸€ä¸ª
  4. å• LLM å®ä¾‹: åªéœ€ä¸€ä¸ª LLM è°ƒç”¨ï¼Œæˆæœ¬è¾ƒä½

  MultipleAgents ç‰¹æ€§

  1. æµå¼ç¼–æ’: é€šè¿‡ Pipeline æ¨¡å¼ç¼–æ’å¤šä¸ª Agent
  2. ä¸“ä¸šåŒ–åˆ†å·¥: æ¯ä¸ª Agent æœ‰ç‰¹å®š System Prompt å’Œå·¥å…·é›†
  3. å¹¶è¡Œèƒ½åŠ›: FanoutPipeline æ”¯æŒå¹¶å‘æ‰§è¡Œï¼Œæå‡æ•ˆç‡
  4. å¤š LLM è°ƒç”¨: N ä¸ª Agent éœ€è¦ N æ¬¡ LLM è°ƒç”¨ï¼Œæˆæœ¬è¾ƒé«˜

  ---
  ğŸ’¡ å®é™…é€‰æ‹©å»ºè®®

  ä½¿ç”¨ PlanNotebook å½“ï¼š

  - âœ… ä»»åŠ¡å¤æ‚ä½†å¯ç”±ä¸€ä¸ªé€šç”¨ Agent å®Œæˆ
  - âœ… éœ€è¦çµæ´»è°ƒæ•´æ‰§è¡Œæ­¥éª¤
  - âœ… ä»»åŠ¡æ­¥éª¤æœ‰å¼ºä¾èµ–å…³ç³»ï¼ˆé¡ºåºæ‰§è¡Œï¼‰
  - âœ… å¸Œæœ›é™ä½ API è°ƒç”¨æˆæœ¬

  ç¤ºä¾‹: æ•°æ®åˆ†ææŠ¥å‘Šç”Ÿæˆï¼ˆæ”¶é›†æ•°æ® â†’ åˆ†æ â†’ ç”ŸæˆæŠ¥å‘Š â†’ ä¿å­˜ï¼‰

  ä½¿ç”¨ MultipleAgents å½“ï¼š

  - âœ… ä»»åŠ¡éœ€è¦ä¸åŒé¢†åŸŸçš„ä¸“ä¸šçŸ¥è¯†
  - âœ… å¯å¹¶è¡Œå¤„ç†ç‹¬ç«‹å­ä»»åŠ¡
  - âœ… éœ€è¦å¤ç”¨å·²æœ‰çš„ Agent ç»„ä»¶
  - âœ… æ¯ä¸ªæ­¥éª¤éœ€è¦ä¸åŒçš„å·¥å…·é›†

  ç¤ºä¾‹: å¤šè¯­è¨€æ–‡æ¡£å¤„ç†æµç¨‹ï¼ˆOCR â†’ ç¿»è¯‘ â†’ æ ¡å¯¹ â†’ æ ¼å¼åŒ–ï¼‰

  ---
  ğŸ”„ æ··åˆä½¿ç”¨åœºæ™¯

  ä¸¤è€…ä¹Ÿå¯ä»¥ç»“åˆä½¿ç”¨ï¼š

  // åœºæ™¯ï¼šè‡ªåŠ¨åŒ–ç ”ç©¶é¡¹ç›®
  ResearchAgent (å¸¦ PlanNotebook)
    â†“ å­ä»»åŠ¡ 0: ä½¿ç”¨ WebSearch å·¥å…·æœé›†èµ„æ–™
    â†“ å­ä»»åŠ¡ 1: è°ƒç”¨ SequentialPipeline
             â”œâ”€ SummarizerAgent (èµ„æ–™æ‘˜è¦)
             â””â”€ TranslatorAgent (ç¿»è¯‘ä¸­æ–‡)
    â†“ å­ä»»åŠ¡ 2: ç”ŸæˆæŠ¥å‘Šå¹¶ä¿å­˜

  PlanNotebook è´Ÿè´£æ•´ä½“è§„åˆ’ï¼ŒPipeline è´Ÿè´£å…·ä½“ç¯èŠ‚çš„ä¸“ä¸šåŒ–å¤„ç†ã€‚

  ---
  å¸Œæœ›è¿™ä¸ªå¯¹æ¯”èƒ½å¸®åŠ©ä½ ç†è§£ä¸¤è€…çš„åŒºåˆ«å’Œåº”ç”¨åœºæ™¯ï¼

> é‚£è¯·é—®å¦‚claude 
codeè¿™æ ·çš„å·¥å…·æ˜¯é€šè¿‡plannotebookæ¶æ„è¿˜æ˜¯ï¼Œå¤šæ™ºèƒ½ä½“æ¶æ„å®ç°çš„ 

â— åŸºäºå¯¹ AgentScope æ¡†æ¶çš„ç†è§£å’Œå¯¹ Claude Code è¡Œä¸ºçš„è§‚å¯Ÿï¼Œæˆ‘å¯ä»¥åˆ†æä¸€ä¸‹å¯èƒ½çš„å®ç°æ¶æ„ã€‚

  ğŸ” Claude Code çš„æ¶æ„ç‰¹å¾åˆ†æ

  ä»ä½¿ç”¨ä½“éªŒæ¥çœ‹ï¼ŒClaude Code æ›´æ¥è¿‘ PlanNotebookï¼ˆå•æ™ºèƒ½ä½“ + å·¥å…·ï¼‰æ¶æ„ï¼Œè€Œä¸æ˜¯å¤šæ™ºèƒ½ä½“ Pipelineã€‚

  å…³é”®è¯æ®

  1. ç»Ÿä¸€çš„å¯¹è¯ç•Œé¢

  ç”¨æˆ·: "å¸®æˆ‘å†™ä¸€ä¸ªç”¨æˆ·è®¤è¯åŠŸèƒ½"

  Claude: æˆ‘éœ€è¦ï¼š
  1. å…ˆæŸ¥çœ‹ç°æœ‰ä»£ç ç»“æ„
  2. åˆ›å»ºç”¨æˆ·æ¨¡å‹
  3. å®ç°è®¤è¯æ§åˆ¶å™¨
  4. æ·»åŠ æµ‹è¯•

  è®©æˆ‘å…ˆæŸ¥çœ‹é¡¹ç›®ç»“æ„...

  ç‰¹å¾ï¼š
  - âœ… å•ä¸€å¯¹è¯å…¥å£ï¼Œç”¨æˆ·ä¸éœ€è¦æŒ‡å®š"è¯·è§„åˆ’Agent"ã€"è¯·ç¼–ç Agent"
  - âœ… Agent è‡ªä¸»å†³å®šæ‰§è¡Œæ­¥éª¤
  - âœ… ç¬¦åˆ PlanNotebook çš„è‡ªä¸»è§„åˆ’ç‰¹æ€§

  2. ä¸°å¯Œçš„å·¥å…·è°ƒç”¨

  ä» Claude Code çš„èƒ½åŠ›æ¥çœ‹ï¼š
  @Tool(name = "read_file")
  public Mono<String> readFile(String path) { }

  @Tool(name = "write_file")
  public Mono<String> writeFile(String path, String content) { }

  @Tool(name = "execute_command")
  public Mono<String> executeCommand(String command) { }

  @Tool(name = "run_tests")
  public Mono<String> runTests() { }

  @Tool(name = "search_code")
  public Mono<String> searchCode(String pattern) { }

  ç‰¹å¾ï¼š
  - âœ… ä¸€ä¸ª Agent é…å¤‡å¤šä¸ªä¸“ä¸šå·¥å…·
  - âœ… é€šè¿‡å·¥å…·è°ƒç”¨æ¥å®Œæˆä¸åŒä»»åŠ¡
  - âœ… ç¬¦åˆ PlanNotebook çš„å·¥å…·é©±åŠ¨ç‰¹æ€§

  3. ä»»åŠ¡çŠ¶æ€è·Ÿè¸ª

  Claude Code èƒ½å¤Ÿï¼š
  âœ“ å·²å®Œæˆï¼šæŸ¥çœ‹é¡¹ç›®ç»“æ„
  âœ“ å·²å®Œæˆï¼šåˆ›å»º User æ¨¡å‹
  â†’ è¿›è¡Œä¸­ï¼šå®ç° AuthController
  â—‹ å¾…å®Œæˆï¼šæ·»åŠ å•å…ƒæµ‹è¯•

  ç‰¹å¾ï¼š
  - âœ… å†…éƒ¨ç»´æŠ¤ä»»åŠ¡çŠ¶æ€
  - âœ… èƒ½å¤Ÿè¿½è¸ªè¿›åº¦
  - âœ… ç¬¦åˆ PlanNotebook çš„çŠ¶æ€ç®¡ç†ç‰¹æ€§

  ---
  ğŸ—ï¸ Claude Code çš„å¯èƒ½æ¶æ„

  æ¨æµ‹çš„å®ç°æ–¹å¼

  // ç±»ä¼¼è¿™æ ·çš„æ¶æ„
  ReActAgent claudeCodeAgent = ReActAgent.builder()
      .name("ClaudeCode")
      .sysPrompt(
          "You are a coding assistant. " +
          "For complex tasks: " +
          "1. Create a plan with create_plan tool " +
          "2. Execute step by step " +
          "3. Use tools to read/write files, run commands..."
      )
      .model(ClaudeChatModel.builder()
          .apiKey(System.getenv("ANTHROPIC_API_KEY"))
          .modelName("claude-sonnet-4-5-20251101")
          .build())
      .planNotebook(PlanNotebook.builder()
          .maxSubtasks(20)
          .needUserConfirm(false)  // æŸäº›æƒ…å†µä¸‹è‡ªåŠ¨æ‰§è¡Œ
          .build())
      .toolkit(toolkit)
      .memory(LongTermMemory.builder()  // æ”¯æŒé•¿å¯¹è¯è®°å¿†
          .embeddingsModel(embeddingsModel)
          .build())
      .hooks(List.of(
          new FileOperationHook(),      // æ–‡ä»¶æ“ä½œç›‘æ§
          new CommandExecutionHook(),   // å‘½ä»¤æ‰§è¡Œç›‘æ§
          new SafetyCheckHook()         // å®‰å…¨æ£€æŸ¥
      ))
      .maxIters(50)
      .build();

  ---
  ğŸ¤” ä¸ºä»€ä¹ˆä¸æ˜¯å¤šæ™ºèƒ½ä½“æ¶æ„ï¼Ÿ

  å¤šæ™ºèƒ½ä½“æ¶æ„çš„å…¸å‹ç‰¹å¾

  å¦‚æœæ˜¯å¤šæ™ºèƒ½ä½“æ¶æ„ï¼Œç”¨æˆ·ä½“éªŒåº”è¯¥æ˜¯è¿™æ ·çš„ï¼š

  âŒ å‡è®¾æ˜¯å¤šæ™ºèƒ½ä½“ï¼š
  ç”¨æˆ·: "å¸®æˆ‘å®ç°ç”¨æˆ·è®¤è¯"

  ç³»ç»Ÿ: è¯·é€‰æ‹©è¦æ‰§è¡Œçš„ Agentï¼š
    [1] PlanningAgent - ä»»åŠ¡è§„åˆ’
    [2] CodeGenAgent - ä»£ç ç”Ÿæˆ
    [3] TestAgent - æµ‹è¯•ç¼–å†™
    [4] ReviewAgent - ä»£ç å®¡æŸ¥

  ç”¨æˆ·: [1] ç„¶åæŒ‰é¡ºåºæ‰§è¡Œ...

  PlanningAgent: æˆ‘åˆ›å»ºäº†å¦‚ä¸‹è®¡åˆ’...

  CodeGenAgent: æ­£åœ¨ç¼–å†™ä»£ç ...

  TestAgent: æ­£åœ¨ç¼–å†™æµ‹è¯•...

  ä½†è¿™ä¸ç¬¦åˆ Claude Code çš„å®é™…ä½“éªŒï¼

  ---
  ğŸ“Š æ¶æ„å¯¹æ¯”

  | ç‰¹æ€§     | Claude Code (å®é™…) | PlanNotebook æ¶æ„   | MultipleAgents æ¶æ„    |
  |----------|--------------------|---------------------|------------------------|
  | å¯¹è¯å…¥å£ | å•ä¸€å¯¹è¯ç•Œé¢       | âœ… å• Agent         | âŒ éœ€è¦é€‰æ‹© Agent      |
  | ä»»åŠ¡è§„åˆ’ | Agent è‡ªä¸»è§„åˆ’     | âœ… create_plan å·¥å…· | âŒ é¢„å®šä¹‰æµç¨‹          |
  | å·¥å…·ä½¿ç”¨ | ç»Ÿä¸€å·¥å…·é›†         | âœ… Toolkit          | âŒ æ¯ä¸ª Agent ç‹¬ç«‹å·¥å…· |
  | çµæ´»æ€§   | åŠ¨æ€è°ƒæ•´æ­¥éª¤       | âœ… revise_plan      | âŒ å›ºå®š Pipeline       |
  | å¹¶è¡Œèƒ½åŠ› | å¶å°”å¹¶è¡Œæœç´¢       | âš ï¸ æœ‰é™æ”¯æŒ         | âœ… FanoutPipeline      |
  | çŠ¶æ€è¿½è¸ª | è‡ªåŠ¨è¿½è¸ªè¿›åº¦       | âœ… SubTask çŠ¶æ€     | âŒ æ— æ˜¾å¼çŠ¶æ€          |
  | è®°å¿†èƒ½åŠ› | é•¿å¯¹è¯è®°å¿†         | âœ… Memory æ¨¡å—      | âš ï¸ æ¯ä¸ª Agent ç‹¬ç«‹     |

  ç»“è®ºï¼šClaude Code â‰ˆ PlanNotebook æ¶æ„

  ---
  ğŸš€ Claude Code å¯èƒ½çš„é«˜çº§ç‰¹æ€§

  è™½ç„¶æ˜¯ PlanNotebook æ¶æ„ï¼Œä½†å¯èƒ½ç»“åˆäº† Pipeline çš„æ€æƒ³ï¼š

  æ··åˆæ¶æ„ç¤ºä¾‹

  // åœºæ™¯ï¼šç”¨æˆ·è¯·æ±‚ "é‡æ„ä»£ç åº“å¹¶æ·»åŠ æµ‹è¯•"

  // ä¸» Agent ä½¿ç”¨ PlanNotebook è¿›è¡Œæ•´ä½“è§„åˆ’
  claudeCodeAgent.call("é‡æ„ä»£ç åº“å¹¶æ·»åŠ æµ‹è¯•")
      .flatMap(plan -> {
          // åˆ›å»ºè®¡åˆ’
          // [0] åˆ†æä»£ç ç»“æ„
          // [1] è¯†åˆ«é‡æ„æœºä¼š
          // [2] æ‰§è¡Œé‡æ„ (å†…éƒ¨è°ƒç”¨ SequentialPipeline)
          // [3] ç”Ÿæˆæµ‹è¯•
      })

  å­ä»»åŠ¡ 2 å¯èƒ½å†…éƒ¨ä½¿ç”¨ Pipelineï¼š
  // åœ¨æ‰§è¡Œé‡æ„æ—¶ï¼Œå¯èƒ½ä¸´æ—¶åˆ›å»º Pipeline
  SequentialPipeline refactorPipeline = SequentialPipeline.builder()
      .addAgent(codeAnalysisAgent)      // åˆ†æä»£ç 
      .addAgent(refactorDesignAgent)     // è®¾è®¡é‡æ„æ–¹æ¡ˆ
      .addAgent(codeGenerationAgent)     // ç”Ÿæˆé‡æ„ä»£ç 
      .addAgent(codeReviewAgent)         // ä»£ç å®¡æŸ¥
      .build();

  ä½†è¿™å¯¹ç”¨æˆ·æ˜¯é€æ˜çš„ï¼Œç”¨æˆ·æ„ŸçŸ¥åˆ°çš„ä»ç„¶æ˜¯ä¸€ä¸ªç»Ÿä¸€çš„ Agentã€‚

  ---
  ğŸ’¡ å®é™…å®ç°è€ƒè™‘

  Claude Code å¯èƒ½çš„æŠ€æœ¯é€‰å‹

  1. ä¸ºä»€ä¹ˆé€‰ PlanNotebookï¼Ÿ
    - âœ… ç”¨æˆ·ä½“éªŒæ›´å¥½ï¼šè‡ªç„¶å¯¹è¯ï¼Œæ— éœ€å­¦ä¹ 
    - âœ… æ›´çµæ´»ï¼šå¯ä»¥åº”å¯¹å„ç§æ„å¤–æƒ…å†µ
    - âœ… æˆæœ¬æ›´ä½ï¼šå• LLM è°ƒç”¨ï¼Œä¸éœ€è¦å¤šä¸ªä¸“ä¸šåŒ– Agent
    - âœ… è°ƒè¯•æ›´å®¹æ˜“ï¼šå•ä¸€æ‰§è¡Œæµç¨‹
  2. å¯èƒ½çš„å¢å¼º
    - å·¥å…·åˆ†ç»„ï¼šä¸åŒä»»åŠ¡æ¿€æ´»ä¸åŒå·¥å…·ç»„ï¼ˆç±»ä¼¼ ToolGroupï¼‰
    - ä¸Šä¸‹æ–‡ç®¡ç†ï¼šä½¿ç”¨é•¿è®°å¿†æ¨¡å—ä¿å­˜é¡¹ç›®ä¸Šä¸‹æ–‡
    - å®‰å…¨æœºåˆ¶ï¼šHook å±‚é¢åšå±é™©æ“ä½œç¡®è®¤
    - æµå¼è¾“å‡ºï¼šå®æ—¶æ˜¾ç¤ºæ‰§è¡Œè¿›åº¦

  ---
  ğŸ¯ ç±»ä¼¼å·¥å…·çš„æ¶æ„

  | å·¥å…·                     | æ¨æµ‹æ¶æ„                | ç†ç”±                         |
  |--------------------------|-------------------------|------------------------------|
  | Claude Code              | PlanNotebook            | å•ä¸€å¯¹è¯ç•Œé¢ï¼Œè‡ªä¸»è§„åˆ’       |
  | GitHub Copilot Workspace | PlanNotebook + Pipeline | ä»»åŠ¡è§„åˆ’ + ä»£ç å®¡æŸ¥ Pipeline |
  | Cursor AI                | PlanNotebook            | ç±»ä¼¼ Claude Code             |
  | Devin (Cognition)        | PlanNotebook + å¾®è°ƒ     | è‡ªä¸» Agent + ä¸“é¡¹ä¼˜åŒ–        |
  | AutoGPT                  | PlanNotebook            | å…¸å‹çš„è‡ªä¸»è§„åˆ’ Agent         |

  ---
  ğŸ”§ å¦‚æœç”¨ AgentScope å®ç° Claude Code

  public class ClaudeCodeClone {
      public static void main(String[] args) {
          // æ³¨å†Œæ‰€æœ‰å·¥å…·
          Toolkit toolkit = new Toolkit();
          toolkit.registerTool(new FileTools());
          toolkit.registerTool(new CommandTools());
          toolkit.registerTool(new GitTools());
          toolkit.registerTool(new TestTools());
          toolkit.registerTool(new SearchTools());

          // åˆ›å»º PlanNotebook
          PlanNotebook notebook = PlanNotebook.builder()
              .maxSubtasks(50)
              .needUserConfirm(false)
              .storage(new DatabasePlanStorage())  // æŒä¹…åŒ–è®¡åˆ’
              .build();

          // åˆ›å»ºä¸» Agent
          ReActAgent agent = ReActAgent.builder()
              .name("ClaudeCode")
              .sysPrompt(loadPrompt("claude-code-prompt.txt"))
              .model(ClaudeChatModel.builder()...)
              .planNotebook(notebook)
              .toolkit(toolkit)
              .memory(new LongTermMemory(...))
              .hooks(List.of(
                  new ProgressDisplayHook(),
                  new SafetyValidationHook()
              ))
              .build();

          // å¯åŠ¨äº¤äº’å¼å¾ªç¯
          while (true) {
              String userInput = getUserInput();
              agent.call(Msg.of(userInput)).block();
          }
      }
  }

  ---
  æ€»ç»“

  Claude Code ä½¿ç”¨ PlanNotebook æ¶æ„ï¼ŒåŸå› ï¼š
  1. âœ… å•ä¸€å¯¹è¯ä½“éªŒ
  2. âœ… è‡ªä¸»ä»»åŠ¡è§„åˆ’
  3. âœ… çµæ´»å·¥å…·è°ƒç”¨
  4. âœ… å†…ç½®çŠ¶æ€è·Ÿè¸ª

  å¯èƒ½ç»“åˆ Pipeline æ€æƒ³ï¼š
  - æŸäº›å¤æ‚å­ä»»åŠ¡å†…éƒ¨å¯èƒ½ä½¿ç”¨ Pipeline
  - ä½†å¯¹ç”¨æˆ·é€æ˜ï¼Œæ„ŸçŸ¥ä¸Šä»æ˜¯å• Agent

  è¿™ä¹Ÿè¯´æ˜äº† PlanNotebook æ¶æ„æ›´é€‚åˆé€šç”¨ AI åŠ©æ‰‹ï¼Œè€Œ MultipleAgents æ›´é€‚åˆå›ºå®šæµç¨‹çš„ä¸šåŠ¡åœºæ™¯ã€‚

> è¯·ç»™å‡ºPlanNotebookExampleçš„å®Œæ•´call tree,å¹¶åšplannotebookçš„åˆ†æè¯´æ˜ 

â— æˆ‘æ¥ä¸ºä½ è¯¦ç»†åˆ†æ PlanNotebookExample çš„å®Œæ•´è°ƒç”¨æ ‘å’Œ PlanNotebook çš„å·¥ä½œæœºåˆ¶ã€‚

â— Read(agentscope-core\src\main\java\io\agentscope\core\agent\AgentBase.java)
  â¿ Â Read 150 lines

â— Read(agentscope-core\src\main\java\io\agentscope\core\ReActAgent.java)
  â¿ Â Read 200 lines

â— Search(pattern: "registerPlanNotebookTools|addPlanNotebookHook", type: "java",
         output_mode: "content")
  â¿ Â Found 0 lines 

â— Search(pattern: "planNotebook\.getCurrentHint|planToHint\.generateHint", type:
         "java", output_mode: "content")
  â¿ Â Found 1 line (ctrl+o to expand)

â— Read(agentscope-core\src\main\java\io\agentscope\core\ReActAgent.java)
  â¿ Â Read 100 lines

â— Read(agentscope-core\src\main\java\io\agentscope\core\ReActAgent.java)
  â¿ Â Read 100 lines

â— Search(pattern: "prepareMessagesWithHint|injectPlanHint", path:
        "agentscope-core\src\main\java\io\agentscope\core\ReActAgent.java",
        output_mode: "content")
  â¿ Â Found 0 lines 

â— Search(pattern: "private List&lt;Msg&gt; prepareMessages\(\)", path:
        "agentscope-core\src\main\java\io\agentscope\core\ReActAgent.java",
        output_mode: "content")
  â¿ Â Found 0 lines 

â— Read(agentscope-core\src\main\java\io\agentscope\core\plan\hint\DefaultPlanToH
      int.java)
  â¿ Â Read 240 lines

â— Search(pattern: "planNotebook\s*!=\s*null|getCurrentHint", path:
        "agentscope-core\src\main\java\io\agentscope\core\ReActAgent.java",
        output_mode: "content")
  â¿ Â Found 67 lines (ctrl+o to expand)

â— Search(pattern: "private void configurePlan", path:
        "agentscope-core\src\main\java\io\agentscope\core\ReActAgent.java",
        output_mode: "content")
  â¿ Â Found 36 lines (ctrl+o to expand)

â— ç°åœ¨æˆ‘å¯ä»¥ä¸ºä½ æä¾›å®Œæ•´çš„è°ƒç”¨æ ‘å’Œè¯¦ç»†åˆ†æäº†ï¼

  ---
  ğŸŒ³ PlanNotebookExample å®Œæ•´è°ƒç”¨æ ‘

  PlanNotebookExample.main()
  â”‚
  â”œâ”€ 1. åˆå§‹åŒ–é˜¶æ®µ
  â”‚   â”œâ”€ Toolkit toolkit = new Toolkit()
  â”‚   â”œâ”€ toolkit.registerTool(new PlanNotebookExample())
  â”‚   â”‚   â””â”€ æ³¨å†Œ: writeFile, readFile, calculate å·¥å…·
  â”‚   â”‚
  â”‚   â”œâ”€ PlanNotebook.builder().build()
  â”‚   â”‚   â””â”€ åˆ›å»º PlanNotebook å®ä¾‹
  â”‚   â”‚       â”œâ”€ planToHint = new DefaultPlanToHint()
  â”‚   â”‚       â”œâ”€ storage = new InMemoryPlanStorage()
  â”‚   â”‚       â”œâ”€ currentPlan = null
  â”‚   â”‚       â””â”€ maxSubtasks = null
  â”‚   â”‚
  â”‚   â””â”€ åˆ›å»º planVisualizationHook (ç”¨æˆ·è‡ªå®šä¹‰)
  â”‚       â””â”€ ç›‘å¬ PostActingEventï¼Œè°ƒç”¨ printPlanState()
  â”‚
  â”œâ”€ 2. æ„å»º Agent é˜¶æ®µ
  â”‚   â””â”€ ReActAgent.builder()
  â”‚       â”œâ”€ .name("PlanAgent")
  â”‚       â”œâ”€ .sysPrompt("...")
  â”‚       â”œâ”€ .model(DashScopeChatModel)
  â”‚       â”œâ”€ .memory(new InMemoryMemory())
  â”‚       â”œâ”€ .toolkit(toolkit)
  â”‚       â”œâ”€ .maxIters(100)
  â”‚       â”œâ”€ .hooks(List.of(planVisualizationHook))
  â”‚       â””â”€ .planNotebook(planNotebook)
  â”‚
  â”œâ”€ 3. Builder.build() å†…éƒ¨ [ReActAgent.java:1343-1500]
  â”‚   â”‚
  â”‚   â”œâ”€ â­ configurePlan(agentToolkit) è¢«è°ƒç”¨
  â”‚   â”‚   â”‚
  â”‚   â”‚   â”œâ”€ 3.1 æ³¨å†Œ PlanNotebook çš„ 10 ä¸ªå·¥å…·
  â”‚   â”‚   â”‚   â””â”€ agentToolkit.registerTool(planNotebook)
  â”‚   â”‚   â”‚       â”œâ”€ create_plan
  â”‚   â”‚   â”‚       â”œâ”€ update_plan_info
  â”‚   â”‚   â”‚       â”œâ”€ revise_current_plan
  â”‚   â”‚   â”‚       â”œâ”€ update_subtask_state
  â”‚   â”‚   â”‚       â”œâ”€ finish_subtask
  â”‚   â”‚   â”‚       â”œâ”€ view_subtasks
  â”‚   â”‚   â”‚       â”œâ”€ get_subtask_count
  â”‚   â”‚   â”‚       â”œâ”€ finish_plan
  â”‚   â”‚   â”‚       â”œâ”€ view_historical_plans
  â”‚   â”‚   â”‚       â””â”€ recover_historical_plan
  â”‚   â”‚   â”‚
  â”‚   â”‚   â””â”€ 3.2 è‡ªåŠ¨æ·»åŠ  PlanHintHook
  â”‚   â”‚       â””â”€ hooks.add(planHintHook)
  â”‚   â”‚           â””â”€ PreReasoningEvent â†’ æ³¨å…¥ plan hint
  â”‚   â”‚
  â”‚   â””â”€ new ReActAgent(this, agentToolkit)
  â”‚       â””â”€ ä¿å­˜ planNotebook å¼•ç”¨
  â”‚
  â”œâ”€ 4. agent.call(userMsg) [userMsg: "è®¡ç®—çŸ©å½¢é¢ç§¯..."]
  â”‚   â”‚
  â”‚   â”œâ”€ 4.1 AgentBase.call(Msg)
  â”‚   â”‚   â”œâ”€ checkRunning()
  â”‚   â”‚   â””â”€ doCall(msgs)
  â”‚   â”‚
  â”‚   â””â”€ 4.2 ReActAgent.doCall(List<Msg>) [ReActAgent.java:246-253]
  â”‚       â””â”€ executeIteration(0)
  â”‚
  â”œâ”€ 5. executeIteration(0) - ç¬¬ 1 è½®è¿­ä»£
  â”‚   â”‚
  â”‚   â””â”€ reasoning(0, false) [ReActAgent.java:406-485]
  â”‚       â”‚
  â”‚       â”œâ”€ 5.1 notifyPreReasoningEvent(prepareMessages())
  â”‚       â”‚   â”‚
  â”‚       â”‚   â”œâ”€ prepareMessages() [æ„å»ºæ¶ˆæ¯åˆ—è¡¨]
  â”‚       â”‚   â”‚   â”œâ”€ system prompt
  â”‚       â”‚   â”‚   â”œâ”€ memory messages (ç©º)
  â”‚       â”‚   â”‚   â””â”€ user message
  â”‚       â”‚   â”‚
  â”‚       â”‚   â”œâ”€ â­ å…³é”®ï¼šPlanHintHook è§¦å‘ï¼
  â”‚       â”‚   â”‚   â”‚
  â”‚       â”‚   â”‚   â””â”€ planHintHook.onEvent(PreReasoningEvent)
  â”‚       â”‚   â”‚       â”‚
  â”‚       â”‚   â”‚       â”œâ”€ planNotebook.getCurrentHint()
  â”‚       â”‚   â”‚       â”‚   â”‚
  â”‚       â”‚   â”‚       â”‚   â””â”€ DefaultPlanToHint.generateHint(null, needUserConfirm=true)
  â”‚       â”‚   â”‚       â”‚       â”‚
  â”‚       â”‚   â”‚       â”‚       â””â”€ [currentPlan == null]
  â”‚       â”‚   â”‚       â”‚           â””â”€ è¿”å› NO_PLAN æç¤º
  â”‚       â”‚   â”‚       â”‚               ```
  â”‚       â”‚   â”‚       â”‚               <system-hint>
  â”‚       â”‚   â”‚       â”‚               å¦‚æœç”¨æˆ·çš„æŸ¥è¯¢å¾ˆå¤æ‚ï¼ˆå¦‚ç¼–ç¨‹ç½‘ç«™ã€æ¸¸æˆæˆ–åº”ç”¨ï¼‰ï¼Œ
  â”‚       â”‚   â”‚       â”‚               æˆ–è€…éœ€è¦å¾ˆé•¿çš„æ­¥éª¤é“¾ï¼ˆå¦‚ä»ä¸åŒæ¥æºç ”ç©¶æŸä¸ªä¸»é¢˜ï¼‰ï¼Œ
  â”‚       â”‚   â”‚       â”‚               ä½ éœ€è¦å…ˆè°ƒç”¨ 'create_plan' åˆ›å»ºè®¡åˆ’ã€‚
  â”‚       â”‚   â”‚       â”‚               å¦åˆ™ï¼Œä½ å¯ä»¥ç›´æ¥æ‰§è¡Œç”¨æˆ·çš„æŸ¥è¯¢è€Œæ— éœ€è§„åˆ’ã€‚
  â”‚       â”‚   â”‚       â”‚
  â”‚       â”‚   â”‚       â”‚               Important Rules:
  â”‚       â”‚   â”‚       â”‚               âš ï¸ ç­‰å¾…ç”¨æˆ·ç¡®è®¤ï¼š
  â”‚       â”‚   â”‚       â”‚               - å±•ç¤ºè®¡åˆ’å¹¶ç¡®è®¤åå†æ‰§è¡Œ
  â”‚       â”‚   â”‚       â”‚               ...
  â”‚       â”‚   â”‚       â”‚               </system-hint>
  â”‚       â”‚   â”‚       â”‚               ```
  â”‚       â”‚   â”‚       â”‚
  â”‚       â”‚   â”‚       â”œâ”€ åˆ›å»º hintMsg (Msg with role=USER, name="user")
  â”‚       â”‚   â”‚       â”‚
  â”‚       â”‚   â”‚       â””â”€ modifiedMsgs.add(hintMsg)
  â”‚       â”‚   â”‚           â””â”€ æ³¨å…¥åˆ°æ¶ˆæ¯åˆ—è¡¨æœ«å°¾ï¼
  â”‚       â”‚   â”‚
  â”‚       â”‚   â””â”€ ç»§ç»­å…¶ä»– Hook...
  â”‚       â”‚
  â”‚       â”œâ”€ 5.2 model.stream(messages, toolSchemas, options)
  â”‚       â”‚   â”‚
  â”‚       â”‚   â””â”€ [LLM æ”¶åˆ°çš„æ¶ˆæ¯]
  â”‚       â”‚       â”œâ”€ System: "You are a systematic assistant..."
  â”‚       â”‚       â”œâ”€ User: "Calculate the area..."
  â”‚       â”‚       â””â”€ User (hint): "<system-hint>ä½ éœ€è¦å…ˆè°ƒç”¨ 'create_plan'...</system-hint>"
  â”‚       â”‚
  â”‚       â”œâ”€ 5.3 LLM æ¨ç†å¹¶å†³å®šè°ƒç”¨å·¥å…·
  â”‚       â”‚   â”‚
  â”‚       â”‚   â””â”€ [LLM å“åº”] ToolUseBlock
  â”‚       â”‚       â””â”€ create_plan å·¥å…·è°ƒç”¨
  â”‚       â”‚           â”œâ”€ name: "è®¡ç®—å¹¶ä¿å­˜çŸ©å½¢é¢ç§¯"
  â”‚       â”‚           â”œâ”€ description: "..."
  â”‚       â”‚           â”œâ”€ expected_outcome: "..."
  â”‚       â”‚           â””â”€ subtasks: [
  â”‚       â”‚               {name: "è®¡ç®—é¢ç§¯", ...},
  â”‚       â”‚               {name: "ä¿å­˜ç»“æœ", ...},
  â”‚       â”‚               {name: "éªŒè¯ç»“æœ", ...}
  â”‚       â”‚           ]
  â”‚       â”‚
  â”‚       â”œâ”€ 5.4 notifyPostReasoningHook
  â”‚       â”‚   â””â”€ memory.addMessage(reasoningMsg)
  â”‚       â”‚
  â”‚       â””â”€ 5.5 acting(0) [ReActAgent.java:500-559]
  â”‚           â”‚
  â”‚           â”œâ”€ notifyPreActingEvent
  â”‚           â”‚
  â”‚           â”œâ”€ executeToolCalls([create_plan])
  â”‚           â”‚   â”‚
  â”‚           â”‚   â””â”€ toolkit.callTools([ToolUseBlock], ...)
  â”‚           â”‚       â”‚
  â”‚           â”‚       â””â”€ PlanNotebook.createPlan(...) [PlanNotebook.java:267-322]
  â”‚           â”‚           â”‚
  â”‚           â”‚           â”œâ”€ è§£æå‚æ•°
  â”‚           â”‚           â”œâ”€ åˆ›å»º Plan å¯¹è±¡
  â”‚           â”‚           â”‚   â””â”€ new Plan(name, description, expectedOutcome, subtasks)
  â”‚           â”‚           â”‚       â”œâ”€ subtasks: [
  â”‚           â”‚           â”‚       â”‚   SubTask[0]: TODO â†’ "è®¡ç®—é¢ç§¯"
  â”‚           â”‚           â”‚       â”‚   SubTask[1]: TODO â†’ "ä¿å­˜ç»“æœ"
  â”‚           â”‚           â”‚       â”‚   SubTask[2]: TODO â†’ "éªŒè¯ç»“æœ"
  â”‚           â”‚           â”‚       â”‚ ]
  â”‚           â”‚           â”‚       â””â”€ state: TODO
  â”‚           â”‚           â”‚
  â”‚           â”‚           â”œâ”€ currentPlan = plan (ä¿å­˜çŠ¶æ€)
  â”‚           â”‚           â”‚
  â”‚           â”‚           â””â”€ triggerPlanChangeHooks()
  â”‚           â”‚               â””â”€ è§¦å‘è®¡åˆ’å˜æ›´å›è°ƒ
  â”‚           â”‚
  â”‚           â””â”€ notifyPostActingEvent(create_plan)
  â”‚               â”‚
  â”‚               â””â”€ â­ planVisualizationHook è§¦å‘ï¼
  â”‚                   â”‚
  â”‚                   â””â”€ printPlanState(notebook, "After create_plan")
  â”‚                       â”‚
  â”‚                       â””â”€ [æ§åˆ¶å°è¾“å‡º]
  â”‚                           ======================================================================
  â”‚                           ğŸ“‹ PLAN STATE [After create_plan]
  â”‚                           ======================================================================
  â”‚                           Plan: è®¡ç®—å¹¶ä¿å­˜çŸ©å½¢é¢ç§¯
  â”‚                           State: TODO
  â”‚
  â”‚                           Subtasks:
  â”‚                             â¸ï¸ [0] è®¡ç®—é¢ç§¯ - TODO
  â”‚                             â¸ï¸ [1] ä¿å­˜ç»“æœåˆ°æ–‡ä»¶ - TODO
  â”‚                             â¸ï¸ [2] éªŒè¯ä¿å­˜çš„ç»“æœ - TODO
  â”‚                           ======================================================================
  â”‚
  â”œâ”€ 6. executeIteration(1) - ç¬¬ 2 è½®è¿­ä»£
  â”‚   â”‚
  â”‚   â””â”€ reasoning(1, false)
  â”‚       â”‚
  â”‚       â”œâ”€ notifyPreReasoningEvent(prepareMessages())
  â”‚       â”‚   â”‚
  â”‚       â”‚   â””â”€ â­ PlanHintHook å†æ¬¡è§¦å‘ï¼
  â”‚       â”‚       â”‚
  â”‚       â”‚       â””â”€ planNotebook.getCurrentHint()
  â”‚       â”‚           â”‚
  â”‚       â”‚           â””â”€ DefaultPlanToHint.generateHint(currentPlan, needUserConfirm=true)
  â”‚       â”‚               â”‚
  â”‚       â”‚               â””â”€ [æ£€æµ‹åˆ°ï¼šæ‰€æœ‰å­ä»»åŠ¡éƒ½æ˜¯ TODO]
  â”‚       â”‚                   â””â”€ è¿”å› AT_THE_BEGINNING æç¤º
  â”‚       â”‚                       ```
  â”‚       â”‚                       <system-hint>
  â”‚       â”‚                       å½“å‰è®¡åˆ’ï¼š
  â”‚       â”‚                       ```
  â”‚       â”‚                       Plan: è®¡ç®—å¹¶ä¿å­˜çŸ©å½¢é¢ç§¯
  â”‚       â”‚                       [0] è®¡ç®—é¢ç§¯ - TODO
  â”‚       â”‚                       [1] ä¿å­˜ç»“æœ - TODO
  â”‚       â”‚                       [2] éªŒè¯ç»“æœ - TODO
  â”‚       â”‚                       ```
  â”‚       â”‚
  â”‚       â”‚                       ä½ çš„é€‰é¡¹åŒ…æ‹¬ï¼š
  â”‚       â”‚                       - é€šè¿‡è°ƒç”¨ 'update_subtask_state' å°†ç¬¬ä¸€ä¸ªå­ä»»åŠ¡
  â”‚       â”‚                         æ ‡è®°ä¸º 'in_progress'ï¼Œå¹¶å¼€å§‹æ‰§è¡Œã€‚
  â”‚       â”‚                       - å¦‚æœç¬¬ä¸€ä¸ªå­ä»»åŠ¡ä¸å¯æ‰§è¡Œï¼Œåˆ†æåŸå› ...
  â”‚       â”‚                       
  â”‚       â”‚                       Important Rules:
  â”‚       â”‚                       âš ï¸ ç­‰å¾…ç”¨æˆ·ç¡®è®¤ï¼š...
  â”‚       â”‚                       </system-hint>
  â”‚       â”‚                       ```
  â”‚       â”‚
  â”‚       â”œâ”€ model.stream(messages + hint)
  â”‚       â”‚
  â”‚       â””â”€ [LLM å†³å®š]
  â”‚           â”œâ”€ è°ƒç”¨ update_subtask_state(0, "in_progress")
  â”‚           â”‚   â””â”€ å°†å­ä»»åŠ¡ 0 æ ‡è®°ä¸º IN_PROGRESS
  â”‚           â”‚
  â”‚           â””â”€ å¯èƒ½ç›´æ¥æ‰§è¡Œè®¡ç®—ï¼ˆå› ä¸ºç”¨æˆ·å·²è¦æ±‚æ‰§è¡Œï¼‰
  â”‚
  â”œâ”€ 7. executeIteration(2) - ç¬¬ 3 è½®è¿­ä»£
  â”‚   â”‚
  â”‚   â””â”€ reasoning(2, false)
  â”‚       â”‚
  â”‚       â””â”€ â­ PlanHintHook è§¦å‘
  â”‚           â”‚
  â”‚           â””â”€ DefaultPlanToHint.generateHint(currentPlan, ...)
  â”‚               â”‚
  â”‚               â””â”€ [æ£€æµ‹åˆ°ï¼šå­ä»»åŠ¡ 0 æ˜¯ IN_PROGRESS]
  â”‚                   â””â”€ è¿”å› WHEN_A_SUBTASK_IN_PROGRESS æç¤º
  â”‚                       ```
  â”‚                       <system-hint>
  â”‚                       å½“å‰è®¡åˆ’ï¼š...
  â”‚                       ç°åœ¨ç´¢å¼• 0 çš„å­ä»»åŠ¡ 'è®¡ç®—é¢ç§¯' æ˜¯ 'in_progress'ã€‚
  â”‚                       è¯¦æƒ…å¦‚ä¸‹ï¼š
  â”‚                       ```
  â”‚                       [0] è®¡ç®—é¢ç§¯ - IN_PROGRESS
  â”‚                          æè¿°ï¼šè®¡ç®—çŸ©å½¢é¢ç§¯ï¼ˆé•¿=10ï¼Œå®½=5ï¼‰
  â”‚                          é¢„æœŸç»“æœï¼š50
  â”‚                       ```
  â”‚                       
  â”‚                       ä½ çš„é€‰é¡¹åŒ…æ‹¬ï¼š
  â”‚                       - ç»§ç»­æ‰§è¡Œå­ä»»åŠ¡å¹¶è·å¾—ç»“æœã€‚
  â”‚                       - å¦‚æœå­ä»»åŠ¡å®Œæˆï¼Œè°ƒç”¨ 'finish_subtask' å¹¶æä¾›å…·ä½“ç»“æœã€‚
  â”‚                       ...
  â”‚                       </system-hint>
  â”‚                       ```
  â”‚
  â”œâ”€ 8. acting(2)
  â”‚   â”‚
  â”‚   â””â”€ executeToolCalls
  â”‚       â”‚
  â”‚       â”œâ”€ calculate("10 * 5")
  â”‚       â”‚   â””â”€ PlanNotebookExample.calculate()
  â”‚       â”‚       â””â”€ è¿”å› "10 * 5 = 50.0"
  â”‚       â”‚
  â”‚       â””â”€ finish_subtask(0, "50")
  â”‚           â”‚
  â”‚           â””â”€ PlanNotebook.finishSubtask(0, "50") [PlanNotebook.java:643-714]
  â”‚               â”‚
  â”‚               â”œâ”€ éªŒè¯å‰ç½®å­ä»»åŠ¡å·²å®Œæˆï¼ˆæ— å‰ç½®ï¼Œé€šè¿‡ï¼‰
  â”‚               â”‚
  â”‚               â”œâ”€ subtasks.get(0).finish("50")
  â”‚               â”‚   â””â”€ SubTask[0].state = DONE
  â”‚               â”‚   â””â”€ SubTask[0].outcome = "50"
  â”‚               â”‚
  â”‚               â”œâ”€ â­ è‡ªåŠ¨æ¿€æ´»ä¸‹ä¸€ä¸ªå­ä»»åŠ¡ï¼
  â”‚               â”‚   â”‚
  â”‚               â”‚   â””â”€ subtasks.get(1).setState(IN_PROGRESS)
  â”‚               â”‚       â””â”€ SubTask[1].state = IN_PROGRESS
  â”‚               â”‚
  â”‚               â””â”€ triggerPlanChangeHooks()
  â”‚                   â””â”€ printPlanState("After finish_subtask")
  â”‚                       ```
  â”‚                       âœ… [0] è®¡ç®—é¢ç§¯ - DONE
  â”‚                       â–¶ï¸ [1] ä¿å­˜ç»“æœåˆ°æ–‡ä»¶ - IN_PROGRESS
  â”‚                       â¸ï¸ [2] éªŒè¯ä¿å­˜çš„ç»“æœ - TODO
  â”‚                       ```
  â”‚
  â”œâ”€ 9. executeIteration(3) - ç¬¬ 4 è½®è¿­ä»£
  â”‚   â”‚
  â”‚   â””â”€ reasoning(3, false)
  â”‚       â”‚
  â”‚       â””â”€ â­ PlanHintHook è§¦å‘
  â”‚           â”‚
  â”‚           â””â”€ DefaultPlanToHint.generateHint(currentPlan, ...)
  â”‚               â”‚
  â”‚               â””â”€ [æ£€æµ‹åˆ°ï¼šå­ä»»åŠ¡ 1 æ˜¯ IN_PROGRESS]
  â”‚                   â””â”€ è¿”å›é’ˆå¯¹å­ä»»åŠ¡ 1 çš„æç¤º
  â”‚                       ```
  â”‚                       ç°åœ¨ç´¢å¼• 1 çš„å­ä»»åŠ¡ 'ä¿å­˜ç»“æœåˆ°æ–‡ä»¶' æ˜¯ 'in_progress'
  â”‚                       è¯¦æƒ…ï¼š...
  â”‚
  â”‚                       ä½ çš„é€‰é¡¹åŒ…æ‹¬ï¼š
  â”‚                       - ç»§ç»­æ‰§è¡Œå­ä»»åŠ¡...
  â”‚                       - å¦‚æœå®Œæˆï¼Œè°ƒç”¨ 'finish_subtask'
  â”‚                       ...
  â”‚                       ```
  â”‚
  â”œâ”€ 10. acting(3)
  â”‚   â”‚
  â”‚   â””â”€ executeToolCalls
  â”‚       â”‚
  â”‚       â”œâ”€ writeFile("result.txt", "50")
  â”‚       â”‚   â””â”€ PlanNotebookExample.writeFile()
  â”‚       â”‚       â””â”€ fileStorage.put("result.txt", "50")
  â”‚       â”‚
  â”‚       â””â”€ finish_subtask(1, "File saved: result.txt")
  â”‚           â”‚
  â”‚           â””â”€ PlanNotebook.finishSubtask(1, "File saved: result.txt")
  â”‚               â”‚
  â”‚               â”œâ”€ éªŒè¯å‰ç½®å­ä»»åŠ¡ï¼ˆå­ä»»åŠ¡ 0 å·² DONE âœ“ï¼‰
  â”‚               â”‚
  â”‚               â”œâ”€ SubTask[1].finish(...)
  â”‚               â”‚
  â”‚               â”œâ”€ è‡ªåŠ¨æ¿€æ´»å­ä»»åŠ¡ 2
  â”‚               â”‚   â””â”€ SubTask[2].state = IN_PROGRESS
  â”‚               â”‚
  â”‚               â””â”€ printPlanState("After finish_subtask")
  â”‚                   ```
  â”‚                   âœ… [0] è®¡ç®—é¢ç§¯ - DONE
  â”‚                   âœ… [1] ä¿å­˜ç»“æœåˆ°æ–‡ä»¶ - DONE
  â”‚                   â–¶ï¸ [2] éªŒè¯ä¿å­˜çš„ç»“æœ - IN_PROGRESS
  â”‚                   ```
  â”‚
  â”œâ”€ 11. executeIteration(4) - ç¬¬ 5 è½®è¿­ä»£
  â”‚   â”‚
  â”‚   â””â”€ reasoning(4, false)
  â”‚       â”‚
  â”‚       â””â”€ â­ PlanHintHook æç¤ºå­ä»»åŠ¡ 2 çš„è¯¦æƒ…
  â”‚
  â”œâ”€ 12. acting(4)
  â”‚   â”‚
  â”‚   â””â”€ executeToolCalls
  â”‚       â”‚
  â”‚       â”œâ”€ readFile("result.txt")
  â”‚       â”‚   â””â”€ è¿”å› "50"
  â”‚       â”‚
  â”‚       â””â”€ finish_subtask(2, "éªŒè¯é€šè¿‡ï¼šæ–‡ä»¶å†…å®¹ä¸º 50")
  â”‚           â”‚
  â”‚           â””â”€ PlanNotebook.finishSubtask(2, "éªŒè¯é€šè¿‡...")
  â”‚               â”‚
  â”‚               â”œâ”€ éªŒè¯å‰ç½®å­ä»»åŠ¡ï¼ˆå­ä»»åŠ¡ 0, 1 å·² DONE âœ“ï¼‰
  â”‚               â”‚
  â”‚               â”œâ”€ SubTask[2].finish(...)
  â”‚               â”‚
  â”‚               â”œâ”€ â­ æ²¡æœ‰ä¸‹ä¸€ä¸ªå­ä»»åŠ¡äº†ï¼Œä¸æ¿€æ´»
  â”‚               â”‚
  â”‚               â””â”€ printPlanState("After finish_subtask")
  â”‚                   ```
  â”‚                   âœ… [0] è®¡ç®—é¢ç§¯ - DONE
  â”‚                   âœ… [1] ä¿å­˜ç»“æœåˆ°æ–‡ä»¶ - DONE
  â”‚                   âœ… [2] éªŒè¯ä¿å­˜çš„ç»“æœ - DONE
  â”‚                   ```
  â”‚
  â”œâ”€ 13. executeIteration(5) - ç¬¬ 6 è½®è¿­ä»£
  â”‚   â”‚
  â”‚   â””â”€ reasoning(5, false)
  â”‚       â”‚
  â”‚       â””â”€ â­ PlanHintHook è§¦å‘
  â”‚           â”‚
  â”‚           â””â”€ DefaultPlanToHint.generateHint(currentPlan, ...)
  â”‚               â”‚
  â”‚               â””â”€ [æ£€æµ‹åˆ°ï¼šæ‰€æœ‰å­ä»»åŠ¡éƒ½æ˜¯ DONE]
  â”‚                   â””â”€ è¿”å› AT_THE_END æç¤º
  â”‚                       ```
  â”‚                       <system-hint>
  â”‚                       å½“å‰è®¡åˆ’ï¼š...
  â”‚                       æ‰€æœ‰å­ä»»åŠ¡éƒ½å·²å®Œæˆã€‚ç°åœ¨ä½ çš„é€‰é¡¹åŒ…æ‹¬ï¼š
  â”‚                       - é€šè¿‡è°ƒç”¨ 'finish_plan' å®Œæˆè®¡åˆ’å¹¶æä¾›å…·ä½“ç»“æœï¼Œ
  â”‚                         å¹¶å‘ç”¨æˆ·æ€»ç»“æ•´ä¸ªè¿‡ç¨‹å’Œç»“æœã€‚
  â”‚                       ...
  â”‚                       </system-hint>
  â”‚                       ```
  â”‚
  â”œâ”€ 14. acting(5)
  â”‚   â”‚
  â”‚   â””â”€ executeToolCalls
  â”‚       â”‚
  â”‚       â””â”€ finish_plan("done", "è®¡ç®—å®Œæˆï¼çŸ©å½¢é¢ç§¯ä¸º 50ï¼Œå·²ä¿å­˜åˆ° result.txt")
  â”‚           â”‚
  â”‚           â””â”€ PlanNotebook.finishPlan("done", outcome) [PlanNotebook.java:802-846]
  â”‚               â”‚
  â”‚               â”œâ”€ currentPlan.finish(DONE, outcome)
  â”‚               â”‚   â””â”€ plan.state = DONE
  â”‚               â”‚
  â”‚               â”œâ”€ storage.addPlan(currentPlan)
  â”‚               â”‚   â””â”€ ä¿å­˜åˆ°å†å²è®°å½•
  â”‚               â”‚
  â”‚               â”œâ”€ currentPlan = null (æ¸…ç©ºå½“å‰è®¡åˆ’)
  â”‚               â”‚
  â”‚               â””â”€ triggerPlanChangeHooks()
  â”‚                   â””â”€ printPlanState("After finish_plan")
  â”‚                       ```
  â”‚                       ğŸ“‹ PLAN STATE [After finish_plan]
  â”‚                       No active plan
  â”‚                       ```
  â”‚
  â”œâ”€ 15. æœ€ç»ˆå“åº”ç”Ÿæˆ
  â”‚   â”‚
  â”‚   â””â”€ reasoning(6, false)
  â”‚       â”‚
  â”‚       â””â”€ model.stream(messages)
  â”‚           â”‚
  â”‚           â””â”€ LLM ç”Ÿæˆæœ€ç»ˆå“åº”
  â”‚               â””â”€ "ä»»åŠ¡å®Œæˆï¼æˆ‘å·²æˆåŠŸï¼š\n1. è®¡ç®—çŸ©å½¢é¢ç§¯ï¼š50\n2..."
  â”‚
  â””â”€ 16. è¿”å›ç»“æœ
      â”‚
      â””â”€ Msg response
          â””â”€ ç”¨æˆ·çœ‹åˆ°æœ€ç»ˆè¾“å‡º

  ---
  ğŸ” PlanNotebook æ·±åº¦åˆ†æ

  ä¸€ã€æ ¸å¿ƒæœºåˆ¶

  1. è‡ªåŠ¨å·¥å…·æ³¨å†Œ [ReActAgent.java:1472-1474]

  private void configurePlan(Toolkit agentToolkit) {
      // å°† PlanNotebook çš„ 10 ä¸ªæ–¹æ³•ä½œä¸ºå·¥å…·æš´éœ²ç»™ LLM
      agentToolkit.registerTool(planNotebook);
  }

  ä½œç”¨ï¼šè®© LLM å¯ä»¥é€šè¿‡å·¥å…·è°ƒç”¨æ¥ç®¡ç†è®¡åˆ’ã€‚

  ---
  2. è‡ªåŠ¨ Hint æ³¨å…¥ [ReActAgent.java:1476-1500]

  Hook planHintHook = new Hook() {
      public <T extends HookEvent> Mono<T> onEvent(T event) {
          if (event instanceof PreReasoningEvent) {
              PreReasoningEvent e = (PreReasoningEvent) event;
              return planNotebook.getCurrentHint()
                  .map(hintMsg -> {
                      List<Msg> modifiedMsgs = new ArrayList<>(e.getInputMessages());
                      modifiedMsgs.add(hintMsg); // æ³¨å…¥ hintï¼
                      e.setInputMessages(modifiedMsgs);
                      return (T) e;
                  })
                  .defaultIfEmpty(event);
          }
          return Mono.just(event);
      }
  };
  hooks.add(planHintHook);

  å…³é”®ï¼š
  - è§¦å‘æ—¶æœºï¼šæ¯æ¬¡ LLM æ¨ç†å‰ï¼ˆPreReasoningEventï¼‰
  - æ³¨å…¥ä½ç½®ï¼šæ¶ˆæ¯åˆ—è¡¨æœ«å°¾
  - å†…å®¹æ ¼å¼ï¼š<system-hint>...</system-hint>
  - ç›®çš„ï¼šå¼•å¯¼ LLM æŒ‰è®¡åˆ’æ‰§è¡Œ

  ---
  3. åŠ¨æ€ Hint ç”Ÿæˆ [DefaultPlanToHint.java:161-238]

  public String generateHint(Plan plan, boolean needUserConfirm) {
      if (plan == null) {
          return NO_PLAN_HINT; // æç¤ºåˆ›å»ºè®¡åˆ’
      }

      // ç»Ÿè®¡å­ä»»åŠ¡çŠ¶æ€
      int nTodo, nInProgress, nDone, nAbandoned;
      Integer inProgressIdx = null;

      // æ ¹æ®çŠ¶æ€è¿”å›ä¸åŒæç¤º
      if (nDone + nAbandoned == all) {
          return AT_THE_END; // æç¤ºå®Œæˆè®¡åˆ’
      } else if (nInProgress == 0 && nDone == 0) {
          return AT_THE_BEGINNING; // æç¤ºå¼€å§‹ç¬¬ä¸€ä¸ªä»»åŠ¡
      } else if (nInProgress > 0) {
          return WHEN_A_SUBTASK_IN_PROGRESS; // æç¤ºæ‰§è¡Œå½“å‰ä»»åŠ¡
      } else if (nInProgress == 0 && nDone > 0) {
          return WHEN_NO_SUBTASK_IN_PROGRESS; // æç¤ºå¼€å§‹ä¸‹ä¸€ä¸ªä»»åŠ¡
      }
  }

  5 ç§ Hint åœºæ™¯ï¼š

  | çŠ¶æ€                      | Hint å†…å®¹                                            | å¼•å¯¼è¡Œä¸º     |
  |---------------------------|------------------------------------------------------|--------------|
  | plan == null              | "å¦‚æœä»»åŠ¡å¤æ‚ï¼Œå…ˆè°ƒç”¨ create_plan"                   | åˆ›å»ºè®¡åˆ’     |
  | å…¨éƒ¨ TODO                 | "é€šè¿‡ update_subtask_state æ ‡è®°ç¬¬ä¸€ä¸ªä¸º in_progress" | å¼€å§‹æ‰§è¡Œ     |
  | æŸä¸ª IN_PROGRESS          | "ç°åœ¨æ‰§è¡Œå­ä»»åŠ¡ Xï¼Œå®Œæˆåè°ƒç”¨ finish_subtask"        | å®Œæˆå½“å‰ä»»åŠ¡ |
  | æ—  IN_PROGRESSï¼Œéƒ¨åˆ† DONE | "æ ‡è®°ä¸‹ä¸€ä¸ªä¸º in_progress"                           | ç»§ç»­ä¸‹ä¸€ä¸ª   |
  | å…¨éƒ¨ DONE/ABANDONED       | "è°ƒç”¨ finish_plan å®Œæˆè®¡åˆ’"                          | ç»“æŸè®¡åˆ’     |

  ---
  4. çŠ¶æ€è‡ªåŠ¨æµè½¬ [PlanNotebook.java:694-712]

  public Mono<String> finishSubtask(int subtaskIdx, String outcome) {
      // 1. éªŒè¯å‰ç½®å­ä»»åŠ¡éƒ½å·²å®Œæˆ
      for (int i = 0; i < subtaskIdx; i++) {
          if (subtasks.get(i).getState() != SubTaskState.DONE) {
              return Mono.error("å‰ç½®ä»»åŠ¡æœªå®Œæˆ");
          }
      }

      // 2. æ ‡è®°å½“å‰ä»»åŠ¡å®Œæˆ
      subtasks.get(subtaskIdx).finish(outcome);

      // 3. è‡ªåŠ¨æ¿€æ´»ä¸‹ä¸€ä¸ªä»»åŠ¡ï¼
      if (subtaskIdx + 1 < subtasks.size()) {
          SubTask nextSubtask = subtasks.get(subtaskIdx + 1);
          nextSubtask.setState(SubTaskState.IN_PROGRESS);
          return Mono.just("ä»»åŠ¡å®Œæˆï¼Œä¸‹ä¸€ä¸ªä»»åŠ¡å·²æ¿€æ´»");
      }

      return Mono.just("ä»»åŠ¡å®Œæˆ");
  }

  å…³é”®è®¾è®¡ï¼š
  - âœ… é¡ºåºæ‰§è¡Œçº¦æŸï¼šå¿…é¡»æŒ‰é¡ºåºå®Œæˆ
  - âœ… è‡ªåŠ¨æ¿€æ´»æœºåˆ¶ï¼šå®Œæˆä¸€ä¸ªè‡ªåŠ¨æ¿€æ´»ä¸‹ä¸€ä¸ª
  - âœ… çŠ¶æ€ä¸€è‡´æ€§ï¼šä¿è¯åªæœ‰ä¸€ä¸ª IN_PROGRESS

  ---
  äºŒã€å…³é”®æŠ€æœ¯ç‚¹

  1. çŠ¶æ€æœºæ¨¡å‹

  Plan çŠ¶æ€æœºï¼š
  TODO â†’ IN_PROGRESS â†’ DONE
    â†“         â†“
    â””â”€â”€â”€â”€â†’ ABANDONED

  SubTask çŠ¶æ€æœºï¼š
  TODO â†’ IN_PROGRESS â†’ DONE
    â†“         â†“
    â””â”€â”€â”€â”€â†’ ABANDONED

  çŠ¶æ€è½¬æ¢è§„åˆ™ï¼š
  - ä»»ä½•çŠ¶æ€éƒ½å¯ä»¥ ABANDONED
  - TODO â†’ IN_PROGRESS éœ€è¦éªŒè¯å‰ç½®ä»»åŠ¡
  - IN_PROGRESS â†’ DONE éœ€è¦æä¾› outcome
  - åªèƒ½æœ‰ä¸€ä¸ªå­ä»»åŠ¡å¤„äº IN_PROGRESS

  ---
  2. Hook ç³»ç»Ÿçš„å·§å¦™è¿ç”¨

  // ç”¨æˆ·è‡ªå®šä¹‰ Hookï¼šç›‘å¬å·¥å…·è°ƒç”¨åçš„äº‹ä»¶
  Hook planVisualizationHook = new Hook() {
      public <T extends HookEvent> Mono<T> onEvent(T event) {
          if (event instanceof PostActingEvent postActing) {
              String toolName = postActing.getToolUse().getName();
              printPlanState(planNotebook, "After " + toolName);
          }
          return Mono.just(event);
      }
  };

  ä½œç”¨ï¼š
  - å¯è§†åŒ–ï¼šå®æ—¶æ˜¾ç¤ºè®¡åˆ’çŠ¶æ€
  - è°ƒè¯•ï¼šè¿½è¸ªå·¥å…·è°ƒç”¨æµç¨‹
  - éä¾µå…¥ï¼šä¸å½±å“ä¸»æµç¨‹

  ---
  3. å“åº”å¼ç¼–ç¨‹ä¼˜åŠ¿

  public Mono<Msg> getCurrentHint() {
      String hintContent = planToHint.generateHint(currentPlan, needUserConfirm);
      if (hintContent != null) {
          return Mono.just(Msg.builder()
              .role(MsgRole.USER)
              .content(TextBlock.builder().text(hintContent).build())
              .build());
      }
      return Mono.empty(); // æ—  hint æ—¶è¿”å›ç©º
  }

  ä¼˜åŠ¿ï¼š
  - âœ… éé˜»å¡ï¼šHint ç”Ÿæˆæœ¬è´¨æ˜¯åŒæ­¥çš„ï¼Œä½†åŒ…è£…æˆ Mono ä¿æŒä¸€è‡´æ€§
  - âœ… å¯ç»„åˆï¼šå¯ä»¥ä¸å…¶ä»– Mono é“¾å¼è°ƒç”¨
  - âœ… æƒ°æ€§ï¼šåªæœ‰è®¢é˜…æ—¶æ‰æ‰§è¡Œ

  ---
  ä¸‰ã€PlanNotebook çš„ä¼˜åŠ¿

  1. å¯¹ LLM çš„å¼•å¯¼

  é—®é¢˜ï¼šLLM é¢å¯¹å¤æ‚ä»»åŠ¡å®¹æ˜“è¿·å¤±

  è§£å†³ï¼šæ¯æ¬¡æ¨ç†å‰æ³¨å…¥ä¸Šä¸‹æ–‡æç¤º
  <system-hint>
  ç°åœ¨æ‰§è¡Œå­ä»»åŠ¡ 0 "è®¡ç®—é¢ç§¯"
  é¢„æœŸç»“æœï¼š50
  ä½ çš„é€‰é¡¹ï¼š
  - ç»§ç»­æ‰§è¡Œ
  - å®Œæˆåè°ƒç”¨ finish_subtask(0, "å…·ä½“ç»“æœ")
  ...
  </system-hint>

  2. å¯¹å¼€å‘è€…çš„å‹å¥½

  é—®é¢˜ï¼šå¦‚ä½•è®© Agent æŒ‰è®¡åˆ’æ‰§è¡Œï¼Ÿ

  è§£å†³ï¼šåªéœ€ä¸€è¡Œé…ç½®
  ReActAgent.builder()
      .planNotebook(PlanNotebook.builder().build())
      .build();

  è‡ªåŠ¨å®Œæˆï¼š
  - âœ… å·¥å…·æ³¨å†Œ
  - âœ… Hook æ³¨å…¥
  - âœ… æç¤ºç”Ÿæˆ

  3. çŠ¶æ€æŒä¹…åŒ–

  @Override
  public void saveTo(Session session, SessionKey sessionKey) {
      session.save(sessionKey, "planNotebook_state",
          new PlanNotebookState(currentPlan));
  }

  @Override
  public void loadFrom(Session session, SessionKey sessionKey) {
      this.currentPlan = null; // å…ˆæ¸…ç©º
      session.get(sessionKey, "planNotebook_state", PlanNotebookState.class)
          .ifPresent(state -> this.currentPlan = state.currentPlan());
  }

  æ”¯æŒåœºæ™¯ï¼š
  - å¯¹è¯ä¸­æ–­åæ¢å¤
  - è·¨ä¼šè¯ä¿å­˜è®¡åˆ’çŠ¶æ€
  - å¤šå®ä¾‹éš”ç¦»ï¼ˆkeyPrefixï¼‰

  ---
  å››ã€ä¸ä»£ç ç¤ºä¾‹çš„å¯¹åº”å…³ç³»

  | ç¤ºä¾‹è¡Œä¸º             | PlanNotebook å†…éƒ¨æœºåˆ¶           | ä»£ç ä½ç½®                         |
  |----------------------|---------------------------------|----------------------------------|
  | Agent çŸ¥é“è¦åˆ›å»ºè®¡åˆ’ | Hint æ³¨å…¥ "create_plan"         | DefaultPlanToHint.java:72-77     |
  | Agent æŒ‰æ­¥éª¤æ‰§è¡Œ     | Hint æç¤ºå½“å‰å­ä»»åŠ¡             | DefaultPlanToHint.java:95-113    |
  | å®Œæˆåè‡ªåŠ¨æ¿€æ´»ä¸‹ä¸€ä¸ª | finishSubtask è‡ªåŠ¨æ¿€æ´»          | PlanNotebook.java:697-701        |
  | ç”¨æˆ·çœ‹åˆ°è¿›åº¦å¯è§†åŒ–   | PostActingHook + printPlanState | PlanNotebookExample.java:160-171 |
  | æœ€åè°ƒç”¨ finish_plan | Hint æç¤º "æ‰€æœ‰ä»»åŠ¡å®Œæˆ"        | DefaultPlanToHint.java:130-141   |

  ---
  äº”ã€æ€»ç»“

  PlanNotebook çš„æœ¬è´¨ï¼š
  1. å·¥å…·é›†ï¼š10 ä¸ªè®¡åˆ’ç®¡ç†å·¥å…·
  2. æç¤ºç”Ÿæˆå™¨ï¼šæ ¹æ®çŠ¶æ€åŠ¨æ€ç”Ÿæˆå¼•å¯¼æç¤º
  3. çŠ¶æ€æœºï¼šç»´æŠ¤è®¡åˆ’å’Œå­ä»»åŠ¡çš„çŠ¶æ€
  4. Hook æ³¨å…¥å™¨ï¼šè‡ªåŠ¨æ³¨å…¥åˆ° Agent æ‰§è¡Œæµç¨‹

  æ ¸å¿ƒä»·å€¼ï¼š
  - âœ… è®©å•ä¸ª Agent å…·å¤‡å¤æ‚ä»»åŠ¡è§„åˆ’å’Œæ‰§è¡Œèƒ½åŠ›
  - âœ… é€šè¿‡æç¤ºå·¥ç¨‹å¼•å¯¼ LLM æŒ‰è®¡åˆ’æ‰§è¡Œ
  - âœ… è‡ªåŠ¨åŒ–çŠ¶æ€ç®¡ç†ï¼Œå‡å°‘æ‰‹åŠ¨å¹²é¢„
  - âœ… å¯è§†åŒ–å’Œå¯è°ƒè¯•

  è¿™è§£é‡Šäº†ä¸ºä»€ä¹ˆ PlanNotebook é€‚åˆå®ç° Claude Code è¿™æ ·çš„å·¥å…·ï¼

> /export plannotebook.md 
  â¿  Conversation exported to: plannotebook.txt

> è¯·é—®PlanNotebookæ˜¯å¦‚ä½•åˆ›å»ºè®¡åˆ’çš„ï¼Œé€šè¿‡æ¨¡å‹åˆ›å»ºçš„å— 

â— éå¸¸å¥½çš„é—®é¢˜ï¼è®©æˆ‘è¯¦ç»†è§£é‡Š PlanNotebook çš„è®¡åˆ’åˆ›å»ºæœºåˆ¶ã€‚

  ---
  ğŸ¯ æ ¸å¿ƒç­”æ¡ˆ

  PlanNotebook æœ¬èº«ä¸åˆ›å»ºè®¡åˆ’ï¼Œå®ƒåªæ˜¯æä¾›ï¼š
  1. å·¥å…·æ¥å£ (create_plan æ–¹æ³•)
  2. çŠ¶æ€ç®¡ç† (ä¿å­˜å’Œè·Ÿè¸ªè®¡åˆ’)

  çœŸæ­£çš„è®¡åˆ’åˆ›å»ºè€…æ˜¯ LLMï¼ˆå¤§è¯­è¨€æ¨¡å‹ï¼‰ï¼

  ---
  ğŸ“Š å®Œæ•´æµç¨‹å›¾è§£

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  é˜¶æ®µ 1: LLM å†³å®šéœ€è¦åˆ›å»ºè®¡åˆ’                                 â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  ç”¨æˆ·è¯·æ±‚: "è®¡ç®—çŸ©å½¢é¢ç§¯å¹¶ä¿å­˜åˆ°æ–‡ä»¶"
      â†“
  ReActAgent.call()
      â†“
  reasoning() ç¬¬ 1 è½®
      â†“
  PreReasoningHook æ³¨å…¥ Hint
      â†“
  å‘é€ç»™ LLM çš„æ¶ˆæ¯:
    - System: "You are a systematic assistant..."
    - User: "è®¡ç®—çŸ©å½¢é¢ç§¯å¹¶ä¿å­˜åˆ°æ–‡ä»¶"
    - User (hint): "<system-hint>
                      å¦‚æœä»»åŠ¡å¤æ‚ï¼Œä½ éœ€è¦å…ˆè°ƒç”¨ 'create_plan' åˆ›å»ºè®¡åˆ’
                     </system-hint>"
      â†“
  LLM æ¨ç†: "è¿™æ˜¯ä¸€ä¸ªå¤šæ­¥éª¤ä»»åŠ¡ï¼Œæˆ‘åº”è¯¥å…ˆåˆ›å»ºè®¡åˆ’"
      â†“
  LLM å†³å®šè°ƒç”¨: create_plan å·¥å…·


  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  é˜¶æ®µ 2: LLM è°ƒç”¨ create_plan å·¥å…· (è®¡åˆ’å†…å®¹ç”± LLM ç”Ÿæˆ)      â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  LLM ç”Ÿæˆå·¥å…·è°ƒç”¨:
  ToolUseBlock {
    name: "create_plan",
    parameters: {
      name: "è®¡ç®—å¹¶ä¿å­˜çŸ©å½¢é¢ç§¯",           â† LLM ç”Ÿæˆçš„è®¡åˆ’åç§°
      description: "è®¡ç®—çŸ©å½¢é¢ç§¯(é•¿=10,å®½=5)ï¼Œä¿å­˜åˆ°æ–‡ä»¶å¹¶éªŒè¯",
      expected_outcome: "çŸ©å½¢é¢ç§¯è®¡ç®—å®Œæˆå¹¶ä¿å­˜",
      subtasks: [                           â† LLM åˆ†è§£çš„å­ä»»åŠ¡
        {
          name: "è®¡ç®—é¢ç§¯",
          description: "ä½¿ç”¨ calculate å·¥å…·è®¡ç®— 10 * 5",
          expected_outcome: "50"
        },
        {
          name: "ä¿å­˜ç»“æœåˆ°æ–‡ä»¶",
          description: "ä½¿ç”¨ writeFile å·¥å…·ä¿å­˜ç»“æœ",
          expected_outcome: "result.txt å·²ä¿å­˜"
        },
        {
          name: "éªŒè¯ä¿å­˜çš„ç»“æœ",
          description: "ä½¿ç”¨ readFile å·¥å…·è¯»å–å¹¶éªŒè¯",
          expected_outcome: "éªŒè¯é€šè¿‡"
        }
      ]
    }
  }
      â†“
  acting() é˜¶æ®µ
      â†“
  toolkit.callTools([create_plan])


  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  é˜¶æ®µ 3: PlanNotebook æ‰§è¡Œ create_plan æ–¹æ³•                   â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  PlanNotebook.createPlan(
    name: "è®¡ç®—å¹¶ä¿å­˜çŸ©å½¢é¢ç§¯",
    description: "...",
    expected_outcome: "...",
    subtasks: [...]
  ) [PlanNotebook.java:267-322]
      â†“
  1. è§£æå‚æ•° (å°† Map è½¬æ¢ä¸º SubTask å¯¹è±¡)
     List<SubTask> subtaskList = [];
     for (Map<String, Object> subtaskMap : subtasks) {
         subtaskList.add(mapToSubTask(subtaskMap));
     }
      â†“
  2. åˆ›å»º Plan å¯¹è±¡
     Plan plan = new Plan(name, description, expectedOutcome, subtaskList);
     // plan.state = TODO
     // plan.subtasks = [
     //   SubTask[0]: {name: "è®¡ç®—é¢ç§¯", state: TODO, ...},
     //   SubTask[1]: {name: "ä¿å­˜ç»“æœ", state: TODO, ...},
     //   SubTask[2]: {name: "éªŒè¯ç»“æœ", state: TODO, ...}
     // ]
      â†“
  3. ä¿å­˜åˆ°å½“å‰è®¡åˆ’
     currentPlan = plan;
      â†“
  4. è§¦å‘ Hook
     triggerPlanChangeHooks();
      â†“
  5. è¿”å›æˆåŠŸæ¶ˆæ¯ç»™ LLM
     return "Plan 'è®¡ç®—å¹¶ä¿å­˜çŸ©å½¢é¢ç§¯' created successfully."


  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  é˜¶æ®µ 4: LLM æ”¶åˆ°åé¦ˆï¼Œç»§ç»­æ‰§è¡Œ                               â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”

  ä¸‹ä¸€è½® reasoning()
      â†“
  PreReasoningHook æ³¨å…¥æ–°çš„ Hint
      â†“
  å‘é€ç»™ LLM çš„æ¶ˆæ¯:
    - System: "..."
    - User: "è®¡ç®—çŸ©å½¢é¢ç§¯å¹¶ä¿å­˜åˆ°æ–‡ä»¶"
    - Assistant: ToolUseBlock(create_plan)
    - User: ToolResultBlock("Plan created successfully")
    - User (hint): "<system-hint>
                      å½“å‰è®¡åˆ’ï¼š
                      [0] è®¡ç®—é¢ç§¯ - TODO
                      [1] ä¿å­˜ç»“æœ - TODO
                      [2] éªŒè¯ç»“æœ - TODO

                      ä½ çš„é€‰é¡¹åŒ…æ‹¬ï¼š
                      - é€šè¿‡è°ƒç”¨ 'update_subtask_state' æ ‡è®°ç¬¬ä¸€ä¸ªä¸º in_progress
                      ...
                     </system-hint>"
      â†“
  LLM æ¨ç†: "å¥½ï¼Œç°åœ¨å¼€å§‹æ‰§è¡Œç¬¬ä¸€ä¸ªä»»åŠ¡"
      â†“
  LLM è°ƒç”¨: update_subtask_state(0, "in_progress")

  ---
  ğŸ”‘ å…³é”®ç‚¹è§£æ

  1. LLM æ˜¯è§„åˆ’è€…

  // LLM æ”¶åˆ°çš„ Hint [DefaultPlanToHint.java:72-77]
  String NO_PLAN =
      "å¦‚æœç”¨æˆ·çš„æŸ¥è¯¢å¾ˆå¤æ‚ï¼ˆå¦‚ç¼–ç¨‹ç½‘ç«™ã€æ¸¸æˆæˆ–åº”ç”¨ï¼‰ï¼Œ" +
      "æˆ–è€…éœ€è¦å¾ˆé•¿çš„æ­¥éª¤é“¾ï¼ˆå¦‚ä»ä¸åŒæ¥æºç ”ç©¶æŸä¸ªä¸»é¢˜ï¼‰ï¼Œ" +
      "ä½ éœ€è¦å…ˆè°ƒç”¨ 'create_plan' åˆ›å»ºè®¡åˆ’ã€‚";

  LLM çš„å†³ç­–è¿‡ç¨‹ï¼š
  LLM æ¨ç†é“¾ï¼š
  1. åˆ†æä»»åŠ¡ï¼š"è®¡ç®—é¢ç§¯ â†’ ä¿å­˜ â†’ éªŒè¯" (3 ä¸ªæ­¥éª¤)
  2. åˆ¤æ–­ï¼šè¿™æ˜¯å¤æ‚ä»»åŠ¡ï¼Œéœ€è¦è§„åˆ’
  3. å†³ç­–ï¼šè°ƒç”¨ create_plan å·¥å…·
  4. ç”Ÿæˆè®¡åˆ’å†…å®¹ï¼š
     - è®¡åˆ’åç§°ï¼š"è®¡ç®—å¹¶ä¿å­˜çŸ©å½¢é¢ç§¯"
     - åˆ†è§£ä¸º 3 ä¸ªå­ä»»åŠ¡
     - æ¯ä¸ªå­ä»»åŠ¡æŒ‡å®šåç§°ã€æè¿°ã€é¢„æœŸç»“æœ

  ---
  2. PlanNotebook æ˜¯æ‰§è¡Œè€…

  @Tool(name = "create_plan", description = "Create a plan by given name and sub-tasks")
  public Mono<String> createPlan(
      @ToolParam(name = "name", description = "...") String name,
      @ToolParam(name = "description", description = "...") String description,
      @ToolParam(name = "expected_outcome", description = "...") String expectedOutcome,
      @ToolParam(name = "subtasks", description = "...") List<Map<String, Object>> subtasks) {

      // PlanNotebook åªè´Ÿè´£ï¼š
      // 1. æ¥æ”¶ LLM ç”Ÿæˆçš„å‚æ•°
      // 2. åˆ›å»º Plan å¯¹è±¡
      // 3. ä¿å­˜åˆ° currentPlan
      // 4. è¿”å›æˆåŠŸæ¶ˆæ¯

      Plan plan = new Plan(name, description, expectedOutcome, subtaskList);
      currentPlan = plan;
      return triggerPlanChangeHooks().thenReturn("Plan created successfully.");
  }

  PlanNotebook ä¸åšï¼š
  - âŒ ä¸åˆ†æä»»åŠ¡
  - âŒ ä¸åˆ†è§£æ­¥éª¤
  - âŒ ä¸å†³å®šå­ä»»åŠ¡å†…å®¹

  PlanNotebook åªåšï¼š
  - âœ… æ¥æ”¶ LLM çš„è®¡åˆ’
  - âœ… ä¿å­˜è®¡åˆ’çŠ¶æ€
  - âœ… è·Ÿè¸ªæ‰§è¡Œè¿›åº¦

  ---
  3. å·¥å…·å®šä¹‰å¼•å¯¼ LLM

  @Tool(name = "create_plan", description = "Create a plan by given name and sub-tasks")
  public Mono<String> createPlan(
      @ToolParam(name = "name", 
          description = "The plan name, should be concise, descriptive and not exceed 10 words")
      String name,
      
      @ToolParam(name = "description", 
          description = "The plan description, including the constraints, target and outcome to be achieved. The description should be clear, specific and concise...")
      String description,
      
      @ToolParam(name = "subtasks", 
          description = "A list of sequential sub-tasks. Each subtask must be an object with: 'name' (string, required), 'description' (string), 'expected_outcome' (string). Example: [{\"name\": \"Calculate area\", \"description\": \"Multiply length by width\", \"expected_outcome\": \"Area value\"}]")
      List<Map<String, Object>> subtasks)

  å·¥å…·çš„ description å°±æ˜¯ç»™ LLM çš„æŒ‡ä»¤ï¼

  LLM çœ‹åˆ°ï¼š
  å·¥å…·åç§°: create_plan
  å·¥å…·æè¿°: "é€šè¿‡ç»™å®šçš„åç§°å’Œå­ä»»åŠ¡åˆ›å»ºè®¡åˆ’"
  å‚æ•°è¯´æ˜:
    - name: è®¡åˆ’åç§°ï¼Œç®€æ´æè¿°ï¼Œä¸è¶…è¿‡ 10 ä¸ªè¯
    - description: è®¡åˆ’æè¿°ï¼ŒåŒ…æ‹¬çº¦æŸã€ç›®æ ‡å’Œé¢„æœŸç»“æœ
    - subtasks: é¡ºåºå­ä»»åŠ¡åˆ—è¡¨ï¼Œæ¯ä¸ªå­ä»»åŠ¡åŒ…å«ï¼š
      * name (å­—ç¬¦ä¸²ï¼Œå¿…éœ€)
      * description (å­—ç¬¦ä¸²)
      * expected_outcome (å­—ç¬¦ä¸²)
      ç¤ºä¾‹: [{"name": "Calculate area", "description": "Multiply length by width", "expected_outcome": "Area value"}]

  LLM æŒ‰ç…§è¿™ä¸ªæ¨¡æ¿ç”Ÿæˆè®¡åˆ’ï¼

  ---
  ğŸ“ å¯¹æ¯”ï¼šæœ‰æ—  PlanNotebook çš„å·®å¼‚

  åœºæ™¯ï¼šæ²¡æœ‰ PlanNotebook

  ç”¨æˆ·: "è®¡ç®—çŸ©å½¢é¢ç§¯å¹¶ä¿å­˜åˆ°æ–‡ä»¶"
      â†“
  LLM ç›´æ¥æ‰§è¡Œ:
    1. è°ƒç”¨ calculate("10 * 5")
    2. è°ƒç”¨ writeFile("result.txt", "50")
    3. è°ƒç”¨ readFile("result.txt")
      â†“
  é—®é¢˜ï¼š
    - LLM å¯èƒ½æ¼æ‰æŸä¸ªæ­¥éª¤
    - æ‰§è¡Œé¡ºåºå¯èƒ½æ··ä¹±
    - æ— æ³•è¿½è¸ªè¿›åº¦
    - ä¸­é€”å‡ºé”™æ— æ³•æ¢å¤

  åœºæ™¯ï¼šæœ‰ PlanNotebook

  ç”¨æˆ·: "è®¡ç®—çŸ©å½¢é¢ç§¯å¹¶ä¿å­˜åˆ°æ–‡ä»¶"
      â†“
  LLM å…ˆåˆ›å»ºè®¡åˆ’:
    create_plan({
      name: "è®¡ç®—å¹¶ä¿å­˜çŸ©å½¢é¢ç§¯",
      subtasks: [
        {name: "è®¡ç®—é¢ç§¯", ...},
        {name: "ä¿å­˜ç»“æœ", ...},
        {name: "éªŒè¯ç»“æœ", ...}
      ]
    })
      â†“
  PlanNotebook ä¿å­˜è®¡åˆ’
      â†“
  Hint æç¤º: "æ ‡è®°ç¬¬ä¸€ä¸ªå­ä»»åŠ¡ä¸º in_progress"
      â†“
  LLM: update_subtask_state(0, "in_progress")
      â†“
  Hint æç¤º: "ç°åœ¨æ‰§è¡Œå­ä»»åŠ¡ 0: è®¡ç®—é¢ç§¯"
      â†“
  LLM: calculate("10 * 5")
      â†“
  LLM: finish_subtask(0, "50")
      â†“
  PlanNotebook è‡ªåŠ¨æ¿€æ´»å­ä»»åŠ¡ 1
      â†“
  Hint æç¤º: "ç°åœ¨æ‰§è¡Œå­ä»»åŠ¡ 1: ä¿å­˜ç»“æœ"
      â†“
  ... ä¾æ¬¡æ‰§è¡Œ
      â†“
  ä¼˜åŠ¿ï¼š
    âœ… ç»“æ„åŒ–æ‰§è¡Œ
    âœ… è¿›åº¦å¯è¿½è¸ª
    âœ… çŠ¶æ€å¯æ¢å¤
    âœ… å¯è§†åŒ–å±•ç¤º

  ---
  ğŸ­ è§’è‰²åˆ†å·¥æ€»ç»“

  | è§’è‰²             | èŒè´£            | èƒ½åŠ›                                                                              |
  |------------------|-----------------|-----------------------------------------------------------------------------------|
  | LLM (å¤§è¯­è¨€æ¨¡å‹) | è§„åˆ’è€…          | - åˆ†æä»»åŠ¡å¤æ‚åº¦- å†³å®šæ˜¯å¦éœ€è¦è®¡åˆ’- åˆ†è§£ä»»åŠ¡æ­¥éª¤- ç”Ÿæˆè®¡åˆ’å†…å®¹                    |
  | PlanNotebook     | æ‰§è¡Œè€… + è·Ÿè¸ªè€… | - æä¾› create_plan å·¥å…·- æ¥æ”¶å¹¶ä¿å­˜è®¡åˆ’- ç®¡ç†è®¡åˆ’çŠ¶æ€- ç”Ÿæˆæ‰§è¡Œæç¤º- å¼ºåˆ¶é¡ºåºæ‰§è¡Œ |
  | ReActAgent       | åè°ƒè€…          | - æ³¨å†Œ PlanNotebook å·¥å…·- æ³¨å…¥ Hint Hook- åè°ƒæ¨ç†å’Œè¡ŒåŠ¨- ç®¡ç†æ‰§è¡Œæµç¨‹            |

  ---
  ğŸ’¡ ç±»æ¯”ç†è§£

  å°±åƒé¡¹ç›®ç»ç†å’Œé¡¹ç›®ç®¡ç†è½¯ä»¶ï¼š

  - LLM = é¡¹ç›®ç»ç†
    - å†³å®šé¡¹ç›®ç›®æ ‡
    - åˆ†è§£ä»»åŠ¡
    - åˆ¶å®šè®¡åˆ’
  - PlanNotebook = Jira/Trello è½¯ä»¶
    - æä¾›åˆ›å»ºä»»åŠ¡çš„ç•Œé¢ï¼ˆcreate_plan å·¥å…·ï¼‰
    - ä¿å­˜ä»»åŠ¡åˆ—è¡¨ï¼ˆcurrentPlanï¼‰
    - è·Ÿè¸ªä»»åŠ¡çŠ¶æ€ï¼ˆTODO â†’ IN_PROGRESS â†’ DONEï¼‰
    - æé†’ä¸‹ä¸€æ­¥æ“ä½œï¼ˆHintï¼‰
  - ReActAgent = å›¢é˜Ÿåä½œå¹³å°
    - æ•´åˆå·¥å…·å’Œè½¯ä»¶
    - åè°ƒå·¥ä½œæµç¨‹

  ---
  ğŸ”§ ä»£ç éªŒè¯

  è®©æˆ‘ä»¬çœ‹ create_plan çš„å®ç°ç»†èŠ‚ï¼š

  @Tool(name = "create_plan", description = "Create a plan by given name and sub-tasks")
  public Mono<String> createPlan(
      @ToolParam(name = "name", description = "The plan name...") String name,
      @ToolParam(name = "description", description = "The plan description...") String description,
      @ToolParam(name = "expected_outcome", description = "The expected outcome...") String expectedOutcome,
      @ToolParam(name = "subtasks", description = "A list of sequential sub-tasks...") List<Map<String, Object>> subtasks) {

      // å…³é”®ï¼šå‚æ•°å…¨éƒ¨ç”± LLM æä¾›ï¼

      // 1. è½¬æ¢ Map ä¸º SubTask å¯¹è±¡
      List<SubTask> subtaskList = new ArrayList<>();
      for (Map<String, Object> subtaskMap : subtasks) {
          subtaskList.add(mapToSubTask(subtaskMap));
          // SubTask çš„ name, description, expected_outcome
          // å…¨éƒ¨æ¥è‡ª LLM ç”Ÿæˆçš„ Mapï¼
      }

      // 2. åˆ›å»º Plan å¯¹è±¡ï¼ˆåªæ˜¯æ•°æ®ç»“æ„ï¼Œä¸å«ä¸šåŠ¡é€»è¾‘ï¼‰
      Plan plan = new Plan(name, description, expectedOutcome, subtaskList);

      // 3. ä¿å­˜åˆ°çŠ¶æ€
      currentPlan = plan;

      // 4. é€šçŸ¥è§‚å¯Ÿè€…
      return triggerPlanChangeHooks()
          .thenReturn(String.format("Plan '%s' created successfully.", name));
  }

  è¯æ®ï¼š
  - âœ… æ‰€æœ‰å‚æ•°éƒ½æ¥è‡ª LLM çš„å·¥å…·è°ƒç”¨
  - âœ… PlanNotebook åªæ˜¯è¢«åŠ¨æ¥æ”¶å’Œä¿å­˜
  - âœ… æ²¡æœ‰ä»»ä½•"æ™ºèƒ½"é€»è¾‘

  ---
  ğŸ¯ æ€»ç»“

  é—®é¢˜ï¼šPlanNotebook æ˜¯å¦‚ä½•åˆ›å»ºè®¡åˆ’çš„ï¼Ÿ

  ç­”æ¡ˆï¼š
  1. ä¸æ˜¯ PlanNotebook åˆ›å»ºè®¡åˆ’
  2. æ˜¯ LLMï¼ˆæ¨¡å‹ï¼‰åˆ›å»ºè®¡åˆ’
  3. PlanNotebook åªæä¾›å·¥å…·æ¥å£å’ŒçŠ¶æ€ç®¡ç†

  æµç¨‹ï¼š
  LLM åˆ†æä»»åŠ¡ â†’ LLM å†³å®šéœ€è¦è®¡åˆ’ â†’ LLM è°ƒç”¨ create_plan å·¥å…· 
  â†’ LLM ç”Ÿæˆè®¡åˆ’å†…å®¹ï¼ˆname, subtasks...ï¼‰ 
  â†’ PlanNotebook æ¥æ”¶å¹¶ä¿å­˜ â†’ PlanNotebook è·Ÿè¸ªæ‰§è¡Œ

  æœ¬è´¨ï¼š
  - LLM = å¤§è„‘ï¼ˆå†³ç­–è€…ï¼‰
  - PlanNotebook = è®°äº‹æœ¬ï¼ˆè®°å½•è€…ï¼‰

  è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ PlanNotebook å¯ä»¥é€‚é…ä»»ä½• LLMï¼ˆOpenAIã€DashScopeã€Anthropic ç­‰ï¼‰ï¼Œå› ä¸ºå®ƒä¸ä¾èµ–ç‰¹å®šæ¨¡å‹çš„"è§„åˆ’èƒ½åŠ›"ï¼Œåªæ˜¯æä¾›ä¸€ä¸ªæ ‡å‡†åŒ–çš„å·¥å…·æ¥å£è®©æ¨¡å‹è°ƒç”¨ï¼



